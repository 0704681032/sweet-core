"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _tokenizer = require("shift-parser/dist/tokenizer");

var _tokenizer2 = _interopRequireDefault(_tokenizer);

var _immutable = require("immutable");

var _syntax = require("./syntax");

var _syntax2 = _interopRequireDefault(_syntax);

var _ramdaFantasy = require("ramda-fantasy");

var _errors = require("./errors");

var _terms = require("./terms");

var _terms2 = _interopRequireDefault(_terms);

var _ramda = require("ramda");

var R = _interopRequireWildcard(_ramda);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const Just_656 = _ramdaFantasy.Maybe.Just;
const Nothing_657 = _ramdaFantasy.Maybe.Nothing;
const LSYNTAX_658 = { name: "left-syntax" };
const RSYNTAX_659 = { name: "right-syntax" };
const AT_660 = { klass: _tokenizer.TokenClass.Punctuator, name: "@" };
const literalKeywords_661 = ["this", "null", "true", "false"];
const isLeftBracket_662 = R.whereEq({ type: _tokenizer.TokenType.LBRACK });
const isLeftBrace_663 = R.whereEq({ type: _tokenizer.TokenType.LBRACE });
const isLeftParen_664 = R.whereEq({ type: _tokenizer.TokenType.LPAREN });
const isRightBracket_665 = R.whereEq({ type: _tokenizer.TokenType.RBRACK });
const isRightBrace_666 = R.whereEq({ type: _tokenizer.TokenType.RBRACE });
const isRightParen_667 = R.whereEq({ type: _tokenizer.TokenType.RPAREN });
const isEOS_668 = R.whereEq({ type: _tokenizer.TokenType.EOS });
const isHash_669 = R.whereEq({ type: _tokenizer.TokenType.IDENTIFIER, value: "#" });
const isLeftSyntax_670 = R.whereEq({ type: LSYNTAX_658 });
const isRightSyntax_671 = R.whereEq({ type: RSYNTAX_659 });
const isLeftDelimiter_672 = R.anyPass([isLeftBracket_662, isLeftBrace_663, isLeftParen_664, isLeftSyntax_670]);
const isRightDelimiter_673 = R.anyPass([isRightBracket_665, isRightBrace_666, isRightParen_667, isRightSyntax_671]);
const isMatchingDelimiters_674 = R.cond([[isLeftBracket_662, (__715, b_716) => isRightBracket_665(b_716)], [isLeftBrace_663, (__717, b_718) => isRightBrace_666(b_718)], [isLeftParen_664, (__719, b_720) => isRightParen_667(b_720)], [isLeftSyntax_670, (__721, b_722) => isRightSyntax_671(b_722)], [R.T, R.F]]);
const assignOps_675 = ["=", "+=", "-=", "*=", "/=", "%=", "<<=", ">>=", ">>>=", "&=", "|=", "^=", ","];
const binaryOps_676 = ["+", "-", "*", "/", "%", "<<", ">>", ">>>", "&", "|", "^", "&&", "||", "?", ":", "===", "==", ">=", "<=", "<", ">", "!=", "!==", "instanceof"];
const unaryOps_677 = ["++", "--", "~", "!", "delete", "void", "typeof", "yield", "throw", "new"];
const isEmpty_678 = R.whereEq({ size: 0 });
const isPunctuator_679 = s_723 => s_723.match("punctuator");
const isKeyword_680 = s_724 => s_724.match("keyword");
const isDelimiter_681 = s_725 => s_725.match("delimiter");
const isParens_682 = s_726 => s_726.match("parens");
const isBraces_683 = s_727 => s_727.match("braces");
const isBrackets_684 = s_728 => s_728.match("brackets");
const isIdentifier_685 = s_729 => s_729.match("identifier");
const val_686 = s_730 => s_730.val();
const isVal_687 = R.curry((v_731, s_732) => s_732.val() === v_731);
const isDot_688 = R.allPass([isPunctuator_679, isVal_687(".")]);
const isColon_689 = R.allPass([isPunctuator_679, isVal_687(":")]);
const isFunctionKeyword_690 = R.allPass([isKeyword_680, isVal_687("function")]);
const isOperator_691 = s_733 => (s_733.match("punctuator") || s_733.match("keyword")) && R.any(R.equals(s_733.val()), assignOps_675.concat(binaryOps_676).concat(unaryOps_677));
const isNonLiteralKeyword_692 = R.allPass([isKeyword_680, s_734 => R.none(R.equals(s_734.val()), literalKeywords_661)]);
const isKeywordExprPrefix_693 = R.allPass([isKeyword_680, s_735 => R.any(R.equals(s_735.val()), ["instanceof", "typeof", "delete", "void", "yield", "throw", "new", "case"])]);
let last_694 = p_736 => p_736.last();
let safeLast_695 = R.pipe(R.cond([[isEmpty_678, R.always(Nothing_657())], [R.T, R.compose(_ramdaFantasy.Maybe.of, last_694)]]));
let stuffTrue_696 = R.curry((p_737, b_738) => b_738 ? Just_656(p_737) : Nothing_657());
let stuffFalse_697 = R.curry((p_739, b_740) => !b_740 ? Just_656(p_739) : Nothing_657());
let isTopColon_698 = R.pipe(safeLast_695, R.map(isColon_689), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isTopPunctuator_699 = R.pipe(safeLast_695, R.map(isPunctuator_679), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isExprReturn_700 = R.curry((l_741, p_742) => {
  let retKwd_743 = safeLast_695(p_742);
  let maybeDot_744 = pop_711(p_742).chain(safeLast_695);
  if (maybeDot_744.map(isDot_688).getOrElse(false)) {
    return true;
  }
  return retKwd_743.map(s_745 => {
    return s_745.match("keyword") && s_745.val() === "return" && s_745.lineNumber() === l_741;
  }).getOrElse(false);
});
const isTopOperator_701 = R.pipe(safeLast_695, R.map(isOperator_691), _ramdaFantasy.Maybe.maybe(false, R.identity));
const isTopKeywordExprPrefix_702 = R.pipe(safeLast_695, R.map(isKeywordExprPrefix_693), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isExprPrefix_703 = R.curry((l_746, b_747) => R.cond([[isEmpty_678, R.always(b_747)], [isTopColon_698, R.always(b_747)], [isTopKeywordExprPrefix_702, R.T], [isTopOperator_701, R.T], [isTopPunctuator_699, R.always(b_747)], [isExprReturn_700(l_746), R.T], [R.T, R.F]]));
let curly_704 = p_748 => safeLast_695(p_748).map(isBraces_683).chain(stuffTrue_696(p_748));
let paren_705 = p_749 => safeLast_695(p_749).map(isParens_682).chain(stuffTrue_696(p_749));
let func_706 = p_750 => safeLast_695(p_750).map(isFunctionKeyword_690).chain(stuffTrue_696(p_750));
let ident_707 = p_751 => safeLast_695(p_751).map(isIdentifier_685).chain(stuffTrue_696(p_751));
let nonLiteralKeyword_708 = p_752 => safeLast_695(p_752).map(isNonLiteralKeyword_692).chain(stuffTrue_696(p_752));
let opt_709 = R.curry((a_753, b_754, p_755) => {
  let result_756 = R.pipeK(a_753, b_754)(_ramdaFantasy.Maybe.of(p_755));
  return _ramdaFantasy.Maybe.isJust(result_756) ? result_756 : _ramdaFantasy.Maybe.of(p_755);
});
let notDot_710 = R.ifElse(R.whereEq({ size: 0 }), Just_656, p_757 => safeLast_695(p_757).map(s_758 => !(s_758.match("punctuator") && s_758.val() === ".")).chain(stuffTrue_696(p_757)));
let pop_711 = R.compose(Just_656, p_759 => p_759.pop());
const functionPrefix_712 = R.pipeK(curly_704, pop_711, paren_705, pop_711, opt_709(ident_707, pop_711), func_706);
const isRegexPrefix_713 = b_760 => R.anyPass([isEmpty_678, isTopPunctuator_699, R.pipe(_ramdaFantasy.Maybe.of, R.pipeK(nonLiteralKeyword_708, pop_711, notDot_710), _ramdaFantasy.Maybe.isJust), R.pipe(_ramdaFantasy.Maybe.of, R.pipeK(paren_705, pop_711, nonLiteralKeyword_708, pop_711, notDot_710), _ramdaFantasy.Maybe.isJust), R.pipe(_ramdaFantasy.Maybe.of, functionPrefix_712, R.chain(p_761 => {
  return safeLast_695(p_761).map(s_762 => s_762.lineNumber()).chain(fnLine_763 => {
    return pop_711(p_761).map(isExprPrefix_703(fnLine_763, b_760));
  }).chain(stuffFalse_697(p_761));
}), _ramdaFantasy.Maybe.isJust), p_764 => {
  let isCurly_765 = _ramdaFantasy.Maybe.isJust(safeLast_695(p_764).map(isBraces_683));
  let alreadyCheckedFunction_766 = R.pipe(_ramdaFantasy.Maybe.of, functionPrefix_712, _ramdaFantasy.Maybe.isJust)(p_764);
  if (alreadyCheckedFunction_766) {
    return false;
  }
  return R.pipe(_ramdaFantasy.Maybe.of, R.chain(curly_704), R.chain(p_767 => {
    return safeLast_695(p_767).map(s_768 => s_768.lineNumber()).chain(curlyLine_769 => {
      return pop_711(p_767).map(isExprPrefix_703(curlyLine_769, b_760));
    }).chain(stuffFalse_697(p_767));
  }), _ramdaFantasy.Maybe.isJust)(p_764);
}]);
function lastEl_714(l_770) {
  return l_770[l_770.length - 1];
}
class Reader extends _tokenizer2.default {
  constructor(strings_771, context_772, replacements_773) {
    super(Array.isArray(strings_771) ? strings_771.join("") : strings_771);
    this.delimStack = new Map();
    this.insideSyntaxTemplate = [false];
    this.context = context_772;
    if (Array.isArray(strings_771)) {
      let totalIndex = 0;
      this.replacementIndex = R.reduce((acc_774, strRep_775) => {
        acc_774.push({ index: totalIndex + strRep_775[0].length, replacement: strRep_775[1] });
        totalIndex += strRep_775[0].length;
        return acc_774;
      }, [], R.zip(strings_771, replacements_773));
    }
  }
  read() {
    let stack_776 = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];
    let b_777 = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];
    let singleDelimiter_778 = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];

    let prefix_779 = (0, _immutable.List)();
    while (true) {
      let tok = this.advance(prefix_779, b_777);
      if (tok.scopesets || tok instanceof _terms2.default) {
        stack_776.push(tok);
        continue;
      }
      if (Array.isArray(tok)) {
        Array.prototype.push.apply(stack_776, tok);
        continue;
      }
      if (_immutable.List.isList(tok)) {
        Array.prototype.push.apply(stack_776, tok.toArray());
        continue;
      }
      if (isEOS_668(tok)) {
        if (stack_776[0] && isLeftDelimiter_672(stack_776[0].token)) {
          throw this.createUnexpected(tok);
        }
        break;
      }
      if (isLeftDelimiter_672(tok)) {
        if (isLeftSyntax_670(tok)) {
          this.insideSyntaxTemplate.push(true);
        }
        let line = tok.slice.startLocation.line;
        let innerB = isLeftBrace_663(tok) ? isExprPrefix_703(line, b_777)(prefix_779) : true;
        let inner = this.read([new _syntax2.default(tok, this.context)], innerB, false);
        let stx = new _syntax2.default(inner, this.context);
        prefix_779 = prefix_779.concat(stx);
        stack_776.push(stx);
        if (singleDelimiter_778) {
          break;
        }
      } else if (isRightDelimiter_673(tok)) {
        if (stack_776[0] && !isMatchingDelimiters_674(stack_776[0].token, tok)) {
          throw this.createUnexpected(tok);
        }
        let stx = new _syntax2.default(tok, this.context);
        stack_776.push(stx);
        if (lastEl_714(this.insideSyntaxTemplate) && isRightSyntax_671(tok)) {
          this.insideSyntaxTemplate.pop();
        }
        break;
      } else {
        let stx = new _syntax2.default(tok, this.context);
        prefix_779 = prefix_779.concat(stx);
        stack_776.push(stx);
      }
    }
    return (0, _immutable.List)(stack_776);
  }
  advance(prefix_780, b_781) {
    let startLocation_782 = this.getLocation();
    this.lastIndex = this.index;
    this.lastLine = this.line;
    this.lastLineStart = this.lineStart;
    this.skipComment();
    this.startIndex = this.index;
    this.startLine = this.line;
    this.startLineStart = this.lineStart;
    if (this.replacementIndex && this.replacementIndex[0] && this.index >= this.replacementIndex[0].index) {
      let rep = this.replacementIndex[0].replacement;
      this.replacementIndex.shift();
      return rep;
    }
    let charCode_783 = this.source.charCodeAt(this.index);
    if (charCode_783 === 96) {
      let element,
          items = [];
      let startLocation_782 = this.getLocation();
      let start = this.index;
      this.index++;
      if (lastEl_714(this.insideSyntaxTemplate)) {
        let slice = this.getSlice(start, startLocation_782);
        return { type: RSYNTAX_659, value: "`", slice: slice };
      }
      do {
        element = this.scanTemplateElement();
        items.push(element);
        if (element.interp) {
          element = this.read([], false, true);
          (0, _errors.assert)(element.size === 1, "should only have read a single delimiter inside a template");
          items.push(element.get(0));
        }
      } while (!element.tail);
      return { type: _tokenizer.TokenType.TEMPLATE, items: (0, _immutable.List)(items) };
    } else if (charCode_783 === 35) {
      let startLocation_782 = this.getLocation();
      let start = this.index;
      let slice = this.getSlice(start, startLocation_782);
      this.index++;
      if (this.source.charCodeAt(this.index) === 96) {
        this.index++;
        return { type: LSYNTAX_658, value: "#`", slice: slice };
      }
      return { type: _tokenizer.TokenType.IDENTIFIER, value: "#", slice: slice };
    } else if (charCode_783 === 64) {
      let startLocation_782 = this.getLocation();
      let start = this.index;
      let slice = this.getSlice(start, startLocation_782);
      this.index++;
      return { type: AT_660, value: "@", slice: slice };
    }
    let lookahead_784 = super.advance();
    if (lookahead_784.type === _tokenizer.TokenType.DIV && isRegexPrefix_713(b_781)(prefix_780)) {
      return super.scanRegExp("/");
    }
    return lookahead_784;
  }
  scanTemplateElement() {
    let startLocation_785 = this.getLocation();
    let start_786 = this.index;
    while (this.index < this.source.length) {
      let ch = this.source.charCodeAt(this.index);
      switch (ch) {
        case 96:
          let slice = this.getSlice(start_786, startLocation_785);
          this.index++;
          return { type: _tokenizer.TokenType.TEMPLATE, tail: true, interp: false, slice: slice };
        case 36:
          if (this.source.charCodeAt(this.index + 1) === 123) {
            let slice = this.getSlice(start_786, startLocation_785);
            this.index += 1;
            return { type: _tokenizer.TokenType.TEMPLATE, tail: false, interp: true, slice: slice };
          }
          this.index++;
          break;
        case 92:
          {
            let octal = this.scanStringEscape("", null)[1];
            if (octal != null) {
              throw this.createILLEGAL();
            }
            break;
          }
        default:
          this.index++;
      }
    }
    throw this.createILLEGAL();
  }
}
exports.default = Reader;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3N3ZWV0L3NoaWZ0LXJlYWRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUVBOztBQUNBOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7SUFBYSxDOzs7Ozs7QUFDYixNQUFNLFdBQVcsb0JBQU0sSUFBdkI7QUFDQSxNQUFNLGNBQWMsb0JBQU0sT0FBMUI7QUFDQSxNQUFNLGNBQWMsRUFBQyxNQUFNLGFBQVAsRUFBcEI7QUFDQSxNQUFNLGNBQWMsRUFBQyxNQUFNLGNBQVAsRUFBcEI7QUFDQSxNQUFNLFNBQVMsRUFBQyxPQUFPLHNCQUFXLFVBQW5CLEVBQStCLE1BQU0sR0FBckMsRUFBZjtBQUNBLE1BQU0sc0JBQXNCLENBQUMsTUFBRCxFQUFTLE1BQVQsRUFBaUIsTUFBakIsRUFBeUIsT0FBekIsQ0FBNUI7QUFDQSxNQUFNLG9CQUFvQixFQUFFLE9BQUYsQ0FBVSxFQUFDLE1BQU0scUJBQVUsTUFBakIsRUFBVixDQUExQjtBQUNBLE1BQU0sa0JBQWtCLEVBQUUsT0FBRixDQUFVLEVBQUMsTUFBTSxxQkFBVSxNQUFqQixFQUFWLENBQXhCO0FBQ0EsTUFBTSxrQkFBa0IsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLE1BQWpCLEVBQVYsQ0FBeEI7QUFDQSxNQUFNLHFCQUFxQixFQUFFLE9BQUYsQ0FBVSxFQUFDLE1BQU0scUJBQVUsTUFBakIsRUFBVixDQUEzQjtBQUNBLE1BQU0sbUJBQW1CLEVBQUUsT0FBRixDQUFVLEVBQUMsTUFBTSxxQkFBVSxNQUFqQixFQUFWLENBQXpCO0FBQ0EsTUFBTSxtQkFBbUIsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLE1BQWpCLEVBQVYsQ0FBekI7QUFDQSxNQUFNLFlBQVksRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLEdBQWpCLEVBQVYsQ0FBbEI7QUFDQSxNQUFNLGFBQWEsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLFVBQWpCLEVB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QUFDRixhQUFLLEVBQUw7QUFDRTtBQUNFLGdCQUFJLFFBQVEsS0FBSyxnQkFBTCxDQUFzQixFQUF0QixFQUEwQixJQUExQixFQUFnQyxDQUFoQyxDQUFaO0FBQ0EsZ0JBQUksU0FBUyxJQUFiLEVBQW1CO0FBQ2pCLG9CQUFNLEtBQUssYUFBTCxFQUFOO0FBQ0Q7QUFDRDtBQUNEO0FBQ0g7QUFDRSxlQUFLLEtBQUw7QUF0Qko7QUF3QkQ7QUFDRCxVQUFNLEtBQUssYUFBTCxFQUFOO0FBQ0Q7QUE1SjJDO2tCQUF6QixNIiwiZmlsZSI6InNoaWZ0LXJlYWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUb2tlbml6ZXIgZnJvbSBcInNoaWZ0LXBhcnNlci9kaXN0L3Rva2VuaXplclwiO1xuaW1wb3J0IHtUb2tlbkNsYXNzLCBUb2tlblR5cGV9IGZyb20gXCJzaGlmdC1wYXJzZXIvZGlzdC90b2tlbml6ZXJcIjtcbmltcG9ydCB7TGlzdH0gZnJvbSBcImltbXV0YWJsZVwiO1xuaW1wb3J0IFN5bnRheCBmcm9tIFwiLi9zeW50YXhcIjtcbmltcG9ydCB7TWF5YmV9IGZyb20gXCJyYW1kYS1mYW50YXN5XCI7XG5pbXBvcnQge2Fzc2VydH0gZnJvbSBcIi4vZXJyb3JzXCI7XG5pbXBvcnQgVGVybSBmcm9tIFwiLi90ZXJtc1wiO1xuaW1wb3J0ICAqIGFzIFIgZnJvbSBcInJhbWRhXCI7XG5jb25zdCBKdXN0XzY1NiA9IE1heWJlLkp1c3Q7XG5jb25zdCBOb3RoaW5nXzY1NyA9IE1heWJlLk5vdGhpbmc7XG5jb25zdCBMU1lOVEFYXzY1OCA9IHtuYW1lOiBcImxlZnQtc3ludGF4XCJ9O1xuY29uc3QgUlNZTlRBWF82NTkgPSB7bmFtZTogXCJyaWdodC1zeW50YXhcIn07XG5jb25zdCBBVF82NjAgPSB7a2xhc3M6IFRva2VuQ2xhc3MuUHVuY3R1YXRvciwgbmFtZTogXCJAXCJ9O1xuY29uc3QgbGl0ZXJhbEtleXdvcmRzXzY2MSA9IFtcInRoaXNcIiwgXCJudWxsXCIsIFwidHJ1ZVwiLCBcImZhbHNlXCJdO1xuY29uc3QgaXNMZWZ0QnJhY2tldF82NjIgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5MQlJBQ0t9KTtcbmNvbnN0IGlzTGVmdEJyYWNlXzY2MyA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLkxCUkFDRX0pO1xuY29uc3QgaXNMZWZ0UGFyZW5fNjY0ID0gUi53aGVyZUVxKHt0eXBlOiBUb2tlblR5cGUuTFBBUkVOfSk7XG5jb25zdCBpc1JpZ2h0QnJhY2tldF82NjUgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5SQlJBQ0t9KTtcbmNvbnN0IGlzUmlnaHRCcmFjZV82NjYgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5SQlJBQ0V9KTtcbmNvbnN0IGlzUmlnaHRQYXJlbl82NjcgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5SUEFSRU59KTtcbmNvbnN0IGlzRU9TXzY2OCA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLkVPU30pO1xuY29uc3QgaXNIYXNoXzY2OSA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLklERU5USUZJRVIsIHZhbHVlOiBcIiNcIn0pO1xuY29uc3QgaXNMZWZ0U3ludGF4XzY3MCA9IFIud2hlcmVFcSh7dHlwZTogTFNZTlRBWF82NTh9KTtcbmNvbnN0IGlzUmlnaHRTeW50YXhfNjcxID0gUi53aGVyZUVxKHt0eXBlOiBSU1lOVEFYXzY1OX0pO1xuY29uc3QgaXNMZWZ0RGVsaW1pdGVyXzY3MiA9IFIuYW55UGFzcyhbaXNMZWZ0QnJhY2tldF82NjIsIGlzTGVmdEJyYWNlXzY2MywgaXNMZWZ0UGFyZW5fNjY0LCBpc0xlZnRTeW50YXhfNjcwXSk7XG5jb25zdCBpc1JpZ2h0RGVsaW1pdGVyXzY3MyA9IFIuYW55UGFzcyhbaXNSaWdodEJyYWNrZXRfNjY1LCBpc1JpZ2h0QnJhY2VfNjY2LCBpc1JpZ2h0UGFyZW5fNjY3LCBpc1JpZ2h0U3ludGF4XzY3MV0pO1xuY29uc3QgaXNNYXRjaGluZ0RlbGltaXRlcnNfNjc0ID0gUi5jb25kKFtbaXNMZWZ0QnJhY2tldF82NjIsIChfXzcxNSwgYl83MTYpID0+IGlzUmlnaHRCcmFja2V0XzY2NShiXzcxNildLCBbaXNMZWZ0QnJhY2VfNjYzLCAoX183MTcsIGJfNzE4KSA9PiBpc1JpZ2h0QnJhY2VfNjY2KGJfNzE4KV0sIFtpc0xlZnRQYXJlbl82NjQsIChfXzcxOSwgYl83MjApID0+IGlzUmlnaHRQYXJlbl82NjcoYl83MjApXSwgW2lzTGVmdFN5bnRheF82NzAsIChfXzcyMSwgYl83MjIpID0+IGlzUmlnaHRTeW50YXhfNjcxKGJfNzIyKV0sIFtSLlQsIFIuRl1dKTtcbmNvbnN0IGFzc2lnbk9wc182NzUgPSBbXCI9XCIsIFwiKz1cIiwgXCItPVwiLCBcIio9XCIsIFwiLz1cIiwgXCIlPVwiLCBcIjw8PVwiLCBcIj4+PVwiLCBcIj4+Pj1cIiwgXCImPVwiLCBcInw9XCIsIFwiXj1cIiwgXCIsXCJdO1xuY29uc3QgYmluYXJ5T3BzXzY3NiA9IFtcIitcIiwgXCItXCIsIFwiKlwiLCBcIi9cIiwgXCIlXCIsIFwiPDxcIiwgXCI+PlwiLCBcIj4+PlwiLCBcIiZcIiwgXCJ8XCIsIFwiXlwiLCBcIiYmXCIsIFwifHxcIiwgXCI/XCIsIFwiOlwiLCBcIj09PVwiLCBcIj09XCIsIFwiPj1cIiwgXCI8PVwiLCBcIjxcIiwgXCI+XCIsIFwiIT1cIiwgXCIhPT1cIiwgXCJpbnN0YW5jZW9mXCJdO1xuY29uc3QgdW5hcnlPcHNfNjc3ID0gW1wiKytcIiwgXCItLVwiLCBcIn5cIiwgXCIhXCIsIFwiZGVsZXRlXCIsIFwidm9pZFwiLCBcInR5cGVvZlwiLCBcInlpZWxkXCIsIFwidGhyb3dcIiwgXCJuZXdcIl07XG5jb25zdCBpc0VtcHR5XzY3OCA9IFIud2hlcmVFcSh7c2l6ZTogMH0pO1xuY29uc3QgaXNQdW5jdHVhdG9yXzY3OSA9IHNfNzIzID0+IHNfNzIzLm1hdGNoKFwicHVuY3R1YXRvclwiKTtcbmNvbnN0IGlzS2V5d29yZF82ODAgPSBzXzcyNCA9PiBzXzcyNC5tYXRjaChcImtleXdvcmRcIik7XG5jb25zdCBpc0RlbGltaXRlcl82ODEgPSBzXzcyNSA9PiBzXzcyNS5tYXRjaChcImRlbGltaXRlclwiKTtcbmNvbnN0IGlzUGFyZW5zXzY4MiA9IHNfNzI2ID0+IHNfNzI2Lm1hdGNoKFwicGFyZW5zXCIpO1xuY29uc3QgaXNCcmFjZXNfNjgzID0gc183MjcgPT4gc183MjcubWF0Y2goXCJicmFjZXNcIik7XG5jb25zdCBpc0JyYWNrZXRzXzY4NCA9IHNfNzI4ID0+IHNfNzI4Lm1hdGNoKFwiYnJhY2tldHNcIik7XG5jb25zdCBpc0lkZW50aWZpZXJfNjg1ID0gc183MjkgPT4gc183MjkubWF0Y2goXCJpZGVudGlmaWVyXCIpO1xuY29uc3QgdmFsXzY4NiA9IHNfNzMwID0+IHNfNzMwLnZhbCgpO1xuY29uc3QgaXNWYWxfNjg3ID0gUi5jdXJyeSgodl83MzEsIHNfNzMyKSA9PiBzXzczMi52YWwoKSA9PT0gdl83MzEpO1xuY29uc3QgaXNEb3RfNjg4ID0gUi5hbGxQYXNzKFtpc1B1bmN0dWF0b3JfNjc5LCBpc1ZhbF82ODcoXCIuXCIpXSk7XG5jb25zdCBpc0NvbG9uXzY4OSA9IFIuYWxsUGFzcyhbaXNQdW5jdHVhdG9yXzY3OSwgaXNWYWxfNjg3KFwiOlwiKV0pO1xuY29uc3QgaXNGdW5jdGlvbktleXdvcmRfNjkwID0gUi5hbGxQYXNzKFtpc0tleXdvcmRfNjgwLCBpc1ZhbF82ODcoXCJmdW5jdGlvblwiKV0pO1xuY29uc3QgaXNPcGVyYXRvcl82OTEgPSBzXzczMyA9PiAoc183MzMubWF0Y2goXCJwdW5jdHVhdG9yXCIpIHx8IHNfNzMzLm1hdGNoKFwia2V5d29yZFwiKSkgJiYgUi5hbnkoUi5lcXVhbHMoc183MzMudmFsKCkpLCBhc3NpZ25PcHNfNjc1LmNvbmNhdChiaW5hcnlPcHNfNjc2KS5jb25jYXQodW5hcnlPcHNfNjc3KSk7XG5jb25zdCBpc05vbkxpdGVyYWxLZXl3b3JkXzY5MiA9IFIuYWxsUGFzcyhbaXNLZXl3b3JkXzY4MCwgc183MzQgPT4gUi5ub25lKFIuZXF1YWxzKHNfNzM0LnZhbCgpKSwgbGl0ZXJhbEtleXdvcmRzXzY2MSldKTtcbmNvbnN0IGlzS2V5d29yZEV4cHJQcmVmaXhfNjkzID0gUi5hbGxQYXNzKFtpc0tleXdvcmRfNjgwLCBzXzczNSA9PiBSLmFueShSLmVxdWFscyhzXzczNS52YWwoKSksIFtcImluc3RhbmNlb2ZcIiwgXCJ0eXBlb2ZcIiwgXCJkZWxldGVcIiwgXCJ2b2lkXCIsIFwieWllbGRcIiwgXCJ0aHJvd1wiLCBcIm5ld1wiLCBcImNhc2VcIl0pXSk7XG5sZXQgbGFzdF82OTQgPSBwXzczNiA9PiBwXzczNi5sYXN0KCk7XG5sZXQgc2FmZUxhc3RfNjk1ID0gUi5waXBlKFIuY29uZChbW2lzRW1wdHlfNjc4LCBSLmFsd2F5cyhOb3RoaW5nXzY1NygpKV0sIFtSLlQsIFIuY29tcG9zZShNYXliZS5vZiwgbGFzdF82OTQpXV0pKTtcbmxldCBzdHVmZlRydWVfNjk2ID0gUi5jdXJyeSgocF83MzcsIGJfNzM4KSA9PiBiXzczOCA/IEp1c3RfNjU2KHBfNzM3KSA6IE5vdGhpbmdfNjU3KCkpO1xubGV0IHN0dWZmRmFsc2VfNjk3ID0gUi5jdXJyeSgocF83MzksIGJfNzQwKSA9PiAhYl83NDAgPyBKdXN0XzY1NihwXzczOSkgOiBOb3RoaW5nXzY1NygpKTtcbmxldCBpc1RvcENvbG9uXzY5OCA9IFIucGlwZShzYWZlTGFzdF82OTUsIFIubWFwKGlzQ29sb25fNjg5KSwgTWF5YmUubWF5YmUoZmFsc2UsIFIuaWRlbnRpdHkpKTtcbmxldCBpc1RvcFB1bmN0dWF0b3JfNjk5ID0gUi5waXBlKHNhZmVMYXN0XzY5NSwgUi5tYXAoaXNQdW5jdHVhdG9yXzY3OSksIE1heWJlLm1heWJlKGZhbHNlLCBSLmlkZW50aXR5KSk7XG5sZXQgaXNFeHByUmV0dXJuXzcwMCA9IFIuY3VycnkoKGxfNzQxLCBwXzc0MikgPT4ge1xuICBsZXQgcmV0S3dkXzc0MyA9IHNhZmVMYXN0XzY5NShwXzc0Mik7XG4gIGxldCBtYXliZURvdF83NDQgPSBwb3BfNzExKHBfNzQyKS5jaGFpbihzYWZlTGFzdF82OTUpO1xuICBpZiAobWF5YmVEb3RfNzQ0Lm1hcChpc0RvdF82ODgpLmdldE9yRWxzZShmYWxzZSkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gcmV0S3dkXzc0My5tYXAoc183NDUgPT4ge1xuICAgIHJldHVybiBzXzc0NS5tYXRjaChcImtleXdvcmRcIikgJiYgc183NDUudmFsKCkgPT09IFwicmV0dXJuXCIgJiYgc183NDUubGluZU51bWJlcigpID09PSBsXzc0MTtcbiAgfSkuZ2V0T3JFbHNlKGZhbHNlKTtcbn0pO1xuY29uc3QgaXNUb3BPcGVyYXRvcl83MDEgPSBSLnBpcGUoc2FmZUxhc3RfNjk1LCBSLm1hcChpc09wZXJhdG9yXzY5MSksIE1heWJlLm1heWJlKGZhbHNlLCBSLmlkZW50aXR5KSk7XG5jb25zdCBpc1RvcEtleXdvcmRFeHByUHJlZml4XzcwMiA9IFIucGlwZShzYWZlTGFzdF82OTUsIFIubWFwKGlzS2V5d29yZEV4cHJQcmVmaXhfNjkzKSwgTWF5YmUubWF5YmUoZmFsc2UsIFIuaWRlbnRpdHkpKTtcbmxldCBpc0V4cHJQcmVmaXhfNzAzID0gUi5jdXJyeSgobF83NDYsIGJfNzQ3KSA9PiBSLmNvbmQoW1tpc0VtcHR5XzY3OCwgUi5hbHdheXMoYl83NDcpXSwgW2lzVG9wQ29sb25fNjk4LCBSLmFsd2F5cyhiXzc0NyldLCBbaXNUb3BLZXl3b3JkRXhwclByZWZpeF83MDIsIFIuVF0sIFtpc1RvcE9wZXJhdG9yXzcwMSwgUi5UXSwgW2lzVG9wUHVuY3R1YXRvcl82OTksIFIuYWx3YXlzKGJfNzQ3KV0sIFtpc0V4cHJSZXR1cm5fNzAwKGxfNzQ2KSwgUi5UXSwgW1IuVCwgUi5GXV0pKTtcbmxldCBjdXJseV83MDQgPSBwXzc0OCA9PiBzYWZlTGFzdF82OTUocF83NDgpLm1hcChpc0JyYWNlc182ODMpLmNoYWluKHN0dWZmVHJ1ZV82OTYocF83NDgpKTtcbmxldCBwYXJlbl83MDUgPSBwXzc0OSA9PiBzYWZlTGFzdF82OTUocF83NDkpLm1hcChpc1BhcmVuc182ODIpLmNoYWluKHN0dWZmVHJ1ZV82OTYocF83NDkpKTtcbmxldCBmdW5jXzcwNiA9IHBfNzUwID0+IHNhZmVMYXN0XzY5NShwXzc1MCkubWFwKGlzRnVuY3Rpb25LZXl3b3JkXzY5MCkuY2hhaW4oc3R1ZmZUcnVlXzY5NihwXzc1MCkpO1xubGV0IGlkZW50XzcwNyA9IHBfNzUxID0+IHNhZmVMYXN0XzY5NShwXzc1MSkubWFwKGlzSWRlbnRpZmllcl82ODUpLmNoYWluKHN0dWZmVHJ1ZV82OTYocF83NTEpKTtcbmxldCBub25MaXRlcmFsS2V5d29yZF83MDggPSBwXzc1MiA9PiBzYWZlTGFzdF82OTUocF83NTIpLm1hcChpc05vbkxpdGVyYWxLZXl3b3JkXzY5MikuY2hhaW4oc3R1ZmZUcnVlXzY5NihwXzc1MikpO1xubGV0IG9wdF83MDkgPSBSLmN1cnJ5KChhXzc1MywgYl83NTQsIHBfNzU1KSA9PiB7XG4gIGxldCByZXN1bHRfNzU2ID0gUi5waXBlSyhhXzc1MywgYl83NTQpKE1heWJlLm9mKHBfNzU1KSk7XG4gIHJldHVybiBNYXliZS5pc0p1c3QocmVzdWx0Xzc1NikgPyByZXN1bHRfNzU2IDogTWF5YmUub2YocF83NTUpO1xufSk7XG5sZXQgbm90RG90XzcxMCA9IFIuaWZFbHNlKFIud2hlcmVFcSh7c2l6ZTogMH0pLCBKdXN0XzY1NiwgcF83NTcgPT4gc2FmZUxhc3RfNjk1KHBfNzU3KS5tYXAoc183NTggPT4gIShzXzc1OC5tYXRjaChcInB1bmN0dWF0b3JcIikgJiYgc183NTgudmFsKCkgPT09IFwiLlwiKSkuY2hhaW4oc3R1ZmZUcnVlXzY5NihwXzc1NykpKTtcbmxldCBwb3BfNzExID0gUi5jb21wb3NlKEp1c3RfNjU2LCBwXzc1OSA9PiBwXzc1OS5wb3AoKSk7XG5jb25zdCBmdW5jdGlvblByZWZpeF83MTIgPSBSLnBpcGVLKGN1cmx5XzcwNCwgcG9wXzcxMSwgcGFyZW5fNzA1LCBwb3BfNzExLCBvcHRfNzA5KGlkZW50XzcwNywgcG9wXzcxMSksIGZ1bmNfNzA2KTtcbmNvbnN0IGlzUmVnZXhQcmVmaXhfNzEzID0gYl83NjAgPT4gUi5hbnlQYXNzKFtpc0VtcHR5XzY3OCwgaXNUb3BQdW5jdHVhdG9yXzY5OSwgUi5waXBlKE1heWJlLm9mLCBSLnBpcGVLKG5vbkxpdGVyYWxLZXl3b3JkXzcwOCwgcG9wXzcxMSwgbm90RG90XzcxMCksIE1heWJlLmlzSnVzdCksIFIucGlwZShNYXliZS5vZiwgUi5waXBlSyhwYXJlbl83MDUsIHBvcF83MTEsIG5vbkxpdGVyYWxLZXl3b3JkXzcwOCwgcG9wXzcxMSwgbm90RG90XzcxMCksIE1heWJlLmlzSnVzdCksIFIucGlwZShNYXliZS5vZiwgZnVuY3Rpb25QcmVmaXhfNzEyLCBSLmNoYWluKHBfNzYxID0+IHtcbiAgcmV0dXJuIHNhZmVMYXN0XzY5NShwXzc2MSkubWFwKHNfNzYyID0+IHNfNzYyLmxpbmVOdW1iZXIoKSkuY2hhaW4oZm5MaW5lXzc2MyA9PiB7XG4gICAgcmV0dXJuIHBvcF83MTEocF83NjEpLm1hcChpc0V4cHJQcmVmaXhfNzAzKGZuTGluZV83NjMsIGJfNzYwKSk7XG4gIH0pLmNoYWluKHN0dWZmRmFsc2VfNjk3KHBfNzYxKSk7XG59KSwgTWF5YmUuaXNKdXN0KSwgcF83NjQgPT4ge1xuICBsZXQgaXNDdXJseV83NjUgPSBNYXliZS5pc0p1c3Qoc2FmZUxhc3RfNjk1KHBfNzY0KS5tYXAoaXNCcmFjZXNfNjgzKSk7XG4gIGxldCBhbHJlYWR5Q2hlY2tlZEZ1bmN0aW9uXzc2NiA9IFIucGlwZShNYXliZS5vZiwgZnVuY3Rpb25QcmVmaXhfNzEyLCBNYXliZS5pc0p1c3QpKHBfNzY0KTtcbiAgaWYgKGFscmVhZHlDaGVja2VkRnVuY3Rpb25fNzY2KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBSLnBpcGUoTWF5YmUub2YsIFIuY2hhaW4oY3VybHlfNzA0KSwgUi5jaGFpbihwXzc2NyA9PiB7XG4gICAgcmV0dXJuIHNhZmVMYXN0XzY5NShwXzc2NykubWFwKHNfNzY4ID0+IHNfNzY4LmxpbmVOdW1iZXIoKSkuY2hhaW4oY3VybHlMaW5lXzc2OSA9PiB7XG4gICAgICByZXR1cm4gcG9wXzcxMShwXzc2NykubWFwKGlzRXhwclByZWZpeF83MDMoY3VybHlMaW5lXzc2OSwgYl83NjApKTtcbiAgICB9KS5jaGFpbihzdHVmZkZhbHNlXzY5NyhwXzc2NykpO1xuICB9KSwgTWF5YmUuaXNKdXN0KShwXzc2NCk7XG59XSk7XG5mdW5jdGlvbiBsYXN0RWxfNzE0KGxfNzcwKSB7XG4gIHJldHVybiBsXzc3MFtsXzc3MC5sZW5ndGggLSAxXTtcbn1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlYWRlciBleHRlbmRzIFRva2VuaXplciB7XG4gIGNvbnN0cnVjdG9yKHN0cmluZ3NfNzcxLCBjb250ZXh0Xzc3MiwgcmVwbGFjZW1lbnRzXzc3Mykge1xuICAgIHN1cGVyKEFycmF5LmlzQXJyYXkoc3RyaW5nc183NzEpID8gc3RyaW5nc183NzEuam9pbihcIlwiKSA6IHN0cmluZ3NfNzcxKTtcbiAgICB0aGlzLmRlbGltU3RhY2sgPSBuZXcgTWFwO1xuICAgIHRoaXMuaW5zaWRlU3ludGF4VGVtcGxhdGUgPSBbZmFsc2VdO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHRfNzcyO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHN0cmluZ3NfNzcxKSkge1xuICAgICAgbGV0IHRvdGFsSW5kZXggPSAwO1xuICAgICAgdGhpcy5yZXBsYWNlbWVudEluZGV4ID0gUi5yZWR1Y2UoKGFjY183NzQsIHN0clJlcF83NzUpID0+IHtcbiAgICAgICAgYWNjXzc3NC5wdXNoKHtpbmRleDogdG90YWxJbmRleCArIHN0clJlcF83NzVbMF0ubGVuZ3RoLCByZXBsYWNlbWVudDogc3RyUmVwXzc3NVsxXX0pO1xuICAgICAgICB0b3RhbEluZGV4ICs9IHN0clJlcF83NzVbMF0ubGVuZ3RoO1xuICAgICAgICByZXR1cm4gYWNjXzc3NDtcbiAgICAgIH0sIFtdLCBSLnppcChzdHJpbmdzXzc3MSwgcmVwbGFjZW1lbnRzXzc3MykpO1xuICAgIH1cbiAgfVxuICByZWFkKHN0YWNrXzc3NiA9IFtdLCBiXzc3NyA9IGZhbHNlLCBzaW5nbGVEZWxpbWl0ZXJfNzc4ID0gZmFsc2UpIHtcbiAgICBsZXQgcHJlZml4Xzc3OSA9IExpc3QoKTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgbGV0IHRvayA9IHRoaXMuYWR2YW5jZShwcmVmaXhfNzc5LCBiXzc3Nyk7XG4gICAgICBpZiAodG9rLnNjb3Blc2V0cyB8fCB0b2sgaW5zdGFuY2VvZiBUZXJtKSB7XG4gICAgICAgIHN0YWNrXzc3Ni5wdXNoKHRvayk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodG9rKSkge1xuICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShzdGFja183NzYsIHRvayk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKExpc3QuaXNMaXN0KHRvaykpIHtcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoc3RhY2tfNzc2LCB0b2sudG9BcnJheSgpKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoaXNFT1NfNjY4KHRvaykpIHtcbiAgICAgICAgaWYgKHN0YWNrXzc3NlswXSAmJiBpc0xlZnREZWxpbWl0ZXJfNjcyKHN0YWNrXzc3NlswXS50b2tlbikpIHtcbiAgICAgICAgICB0aHJvdyB0aGlzLmNyZWF0ZVVuZXhwZWN0ZWQodG9rKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChpc0xlZnREZWxpbWl0ZXJfNjcyKHRvaykpIHtcbiAgICAgICAgaWYgKGlzTGVmdFN5bnRheF82NzAodG9rKSkge1xuICAgICAgICAgIHRoaXMuaW5zaWRlU3ludGF4VGVtcGxhdGUucHVzaCh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbGluZSA9IHRvay5zbGljZS5zdGFydExvY2F0aW9uLmxpbmU7XG4gICAgICAgIGxldCBpbm5lckIgPSBpc0xlZnRCcmFjZV82NjModG9rKSA/IGlzRXhwclByZWZpeF83MDMobGluZSwgYl83NzcpKHByZWZpeF83NzkpIDogdHJ1ZTtcbiAgICAgICAgbGV0IGlubmVyID0gdGhpcy5yZWFkKFtuZXcgU3ludGF4KHRvaywgdGhpcy5jb250ZXh0KV0sIGlubmVyQiwgZmFsc2UpO1xuICAgICAgICBsZXQgc3R4ID0gbmV3IFN5bnRheChpbm5lciwgdGhpcy5jb250ZXh0KTtcbiAgICAgICAgcHJlZml4Xzc3OSA9IHByZWZpeF83NzkuY29uY2F0KHN0eCk7XG4gICAgICAgIHN0YWNrXzc3Ni5wdXNoKHN0eCk7XG4gICAgICAgIGlmIChzaW5nbGVEZWxpbWl0ZXJfNzc4KSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoaXNSaWdodERlbGltaXRlcl82NzModG9rKSkge1xuICAgICAgICBpZiAoc3RhY2tfNzc2WzBdICYmICFpc01hdGNoaW5nRGVsaW1pdGVyc182NzQoc3RhY2tfNzc2WzBdLnRva2VuLCB0b2spKSB7XG4gICAgICAgICAgdGhyb3cgdGhpcy5jcmVhdGVVbmV4cGVjdGVkKHRvayk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHN0eCA9IG5ldyBTeW50YXgodG9rLCB0aGlzLmNvbnRleHQpO1xuICAgICAgICBzdGFja183NzYucHVzaChzdHgpO1xuICAgICAgICBpZiAobGFzdEVsXzcxNCh0aGlzLmluc2lkZVN5bnRheFRlbXBsYXRlKSAmJiBpc1JpZ2h0U3ludGF4XzY3MSh0b2spKSB7XG4gICAgICAgICAgdGhpcy5pbnNpZGVTeW50YXhUZW1wbGF0ZS5wb3AoKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBzdHggPSBuZXcgU3ludGF4KHRvaywgdGhpcy5jb250ZXh0KTtcbiAgICAgICAgcHJlZml4Xzc3OSA9IHByZWZpeF83NzkuY29uY2F0KHN0eCk7XG4gICAgICAgIHN0YWNrXzc3Ni5wdXNoKHN0eCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBMaXN0KHN0YWNrXzc3Nik7XG4gIH1cbiAgYWR2YW5jZShwcmVmaXhfNzgwLCBiXzc4MSkge1xuICAgIGxldCBzdGFydExvY2F0aW9uXzc4MiA9IHRoaXMuZ2V0TG9jYXRpb24oKTtcbiAgICB0aGlzLmxhc3RJbmRleCA9IHRoaXMuaW5kZXg7XG4gICAgdGhpcy5sYXN0TGluZSA9IHRoaXMubGluZTtcbiAgICB0aGlzLmxhc3RMaW5lU3RhcnQgPSB0aGlzLmxpbmVTdGFydDtcbiAgICB0aGlzLnNraXBDb21tZW50KCk7XG4gICAgdGhpcy5zdGFydEluZGV4ID0gdGhpcy5pbmRleDtcbiAgICB0aGlzLnN0YXJ0TGluZSA9IHRoaXMubGluZTtcbiAgICB0aGlzLnN0YXJ0TGluZVN0YXJ0ID0gdGhpcy5saW5lU3RhcnQ7XG4gICAgaWYgKHRoaXMucmVwbGFjZW1lbnRJbmRleCAmJiB0aGlzLnJlcGxhY2VtZW50SW5kZXhbMF0gJiYgdGhpcy5pbmRleCA+PSB0aGlzLnJlcGxhY2VtZW50SW5kZXhbMF0uaW5kZXgpIHtcbiAgICAgIGxldCByZXAgPSB0aGlzLnJlcGxhY2VtZW50SW5kZXhbMF0ucmVwbGFjZW1lbnQ7XG4gICAgICB0aGlzLnJlcGxhY2VtZW50SW5kZXguc2hpZnQoKTtcbiAgICAgIHJldHVybiByZXA7XG4gICAgfVxuICAgIGxldCBjaGFyQ29kZV83ODMgPSB0aGlzLnNvdXJjZS5jaGFyQ29kZUF0KHRoaXMuaW5kZXgpO1xuICAgIGlmIChjaGFyQ29kZV83ODMgPT09IDk2KSB7XG4gICAgICBsZXQgZWxlbWVudCwgaXRlbXMgPSBbXTtcbiAgICAgIGxldCBzdGFydExvY2F0aW9uXzc4MiA9IHRoaXMuZ2V0TG9jYXRpb24oKTtcbiAgICAgIGxldCBzdGFydCA9IHRoaXMuaW5kZXg7XG4gICAgICB0aGlzLmluZGV4Kys7XG4gICAgICBpZiAobGFzdEVsXzcxNCh0aGlzLmluc2lkZVN5bnRheFRlbXBsYXRlKSkge1xuICAgICAgICBsZXQgc2xpY2UgPSB0aGlzLmdldFNsaWNlKHN0YXJ0LCBzdGFydExvY2F0aW9uXzc4Mik7XG4gICAgICAgIHJldHVybiB7dHlwZTogUlNZTlRBWF82NTksIHZhbHVlOiBcImBcIiwgc2xpY2U6IHNsaWNlfTtcbiAgICAgIH1cbiAgICAgIGRvIHtcbiAgICAgICAgZWxlbWVudCA9IHRoaXMuc2NhblRlbXBsYXRlRWxlbWVudCgpO1xuICAgICAgICBpdGVtcy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICBpZiAoZWxlbWVudC5pbnRlcnApIHtcbiAgICAgICAgICBlbGVtZW50ID0gdGhpcy5yZWFkKFtdLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgYXNzZXJ0KGVsZW1lbnQuc2l6ZSA9PT0gMSwgXCJzaG91bGQgb25seSBoYXZlIHJlYWQgYSBzaW5nbGUgZGVsaW1pdGVyIGluc2lkZSBhIHRlbXBsYXRlXCIpO1xuICAgICAgICAgIGl0ZW1zLnB1c2goZWxlbWVudC5nZXQoMCkpO1xuICAgICAgICB9XG4gICAgICB9IHdoaWxlICghZWxlbWVudC50YWlsKTtcbiAgICAgIHJldHVybiB7dHlwZTogVG9rZW5UeXBlLlRFTVBMQVRFLCBpdGVtczogTGlzdChpdGVtcyl9O1xuICAgIH0gZWxzZSBpZiAoY2hhckNvZGVfNzgzID09PSAzNSkge1xuICAgICAgbGV0IHN0YXJ0TG9jYXRpb25fNzgyID0gdGhpcy5nZXRMb2NhdGlvbigpO1xuICAgICAgbGV0IHN0YXJ0ID0gdGhpcy5pbmRleDtcbiAgICAgIGxldCBzbGljZSA9IHRoaXMuZ2V0U2xpY2Uoc3RhcnQsIHN0YXJ0TG9jYXRpb25fNzgyKTtcbiAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgIGlmICh0aGlzLnNvdXJjZS5jaGFyQ29kZUF0KHRoaXMuaW5kZXgpID09PSA5Nikge1xuICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgIHJldHVybiB7dHlwZTogTFNZTlRBWF82NTgsIHZhbHVlOiBcIiNgXCIsIHNsaWNlOiBzbGljZX07XG4gICAgICB9XG4gICAgICByZXR1cm4ge3R5cGU6IFRva2VuVHlwZS5JREVOVElGSUVSLCB2YWx1ZTogXCIjXCIsIHNsaWNlOiBzbGljZX07XG4gICAgfSBlbHNlIGlmIChjaGFyQ29kZV83ODMgPT09IDY0KSB7XG4gICAgICBsZXQgc3RhcnRMb2NhdGlvbl83ODIgPSB0aGlzLmdldExvY2F0aW9uKCk7XG4gICAgICBsZXQgc3RhcnQgPSB0aGlzLmluZGV4O1xuICAgICAgbGV0IHNsaWNlID0gdGhpcy5nZXRTbGljZShzdGFydCwgc3RhcnRMb2NhdGlvbl83ODIpO1xuICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgcmV0dXJuIHt0eXBlOiBBVF82NjAsIHZhbHVlOiBcIkBcIiwgc2xpY2U6IHNsaWNlfTtcbiAgICB9XG4gICAgbGV0IGxvb2thaGVhZF83ODQgPSBzdXBlci5hZHZhbmNlKCk7XG4gICAgaWYgKGxvb2thaGVhZF83ODQudHlwZSA9PT0gVG9rZW5UeXBlLkRJViAmJiBpc1JlZ2V4UHJlZml4XzcxMyhiXzc4MSkocHJlZml4Xzc4MCkpIHtcbiAgICAgIHJldHVybiBzdXBlci5zY2FuUmVnRXhwKFwiL1wiKTtcbiAgICB9XG4gICAgcmV0dXJuIGxvb2thaGVhZF83ODQ7XG4gIH1cbiAgc2NhblRlbXBsYXRlRWxlbWVudCgpIHtcbiAgICBsZXQgc3RhcnRMb2NhdGlvbl83ODUgPSB0aGlzLmdldExvY2F0aW9uKCk7XG4gICAgbGV0IHN0YXJ0Xzc4NiA9IHRoaXMuaW5kZXg7XG4gICAgd2hpbGUgKHRoaXMuaW5kZXggPCB0aGlzLnNvdXJjZS5sZW5ndGgpIHtcbiAgICAgIGxldCBjaCA9IHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy5pbmRleCk7XG4gICAgICBzd2l0Y2ggKGNoKSB7XG4gICAgICAgIGNhc2UgOTY6XG4gICAgICAgICAgbGV0IHNsaWNlID0gdGhpcy5nZXRTbGljZShzdGFydF83ODYsIHN0YXJ0TG9jYXRpb25fNzg1KTtcbiAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgcmV0dXJuIHt0eXBlOiBUb2tlblR5cGUuVEVNUExBVEUsIHRhaWw6IHRydWUsIGludGVycDogZmFsc2UsIHNsaWNlOiBzbGljZX07XG4gICAgICAgIGNhc2UgMzY6XG4gICAgICAgICAgaWYgKHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy5pbmRleCArIDEpID09PSAxMjMpIHtcbiAgICAgICAgICAgIGxldCBzbGljZSA9IHRoaXMuZ2V0U2xpY2Uoc3RhcnRfNzg2LCBzdGFydExvY2F0aW9uXzc4NSk7XG4gICAgICAgICAgICB0aGlzLmluZGV4ICs9IDE7XG4gICAgICAgICAgICByZXR1cm4ge3R5cGU6IFRva2VuVHlwZS5URU1QTEFURSwgdGFpbDogZmFsc2UsIGludGVycDogdHJ1ZSwgc2xpY2U6IHNsaWNlfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDkyOlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxldCBvY3RhbCA9IHRoaXMuc2NhblN0cmluZ0VzY2FwZShcIlwiLCBudWxsKVsxXTtcbiAgICAgICAgICAgIGlmIChvY3RhbCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgIHRocm93IHRoaXMuY3JlYXRlSUxMRUdBTCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgdGhpcy5jcmVhdGVJTExFR0FMKCk7XG4gIH1cbn1cbiJdfQ==