"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _tokenizer = require("shift-parser/dist/tokenizer");

var _tokenizer2 = _interopRequireDefault(_tokenizer);

var _immutable = require("immutable");

var _syntax = require("./syntax");

var _syntax2 = _interopRequireDefault(_syntax);

var _ramdaFantasy = require("ramda-fantasy");

var _errors = require("./errors");

var _terms = require("./terms");

var _terms2 = _interopRequireDefault(_terms);

var _ramda = require("ramda");

var R = _interopRequireWildcard(_ramda);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const Just_656 = _ramdaFantasy.Maybe.Just;
const Nothing_657 = _ramdaFantasy.Maybe.Nothing;
const LSYNTAX_658 = { name: "left-syntax" };
const RSYNTAX_659 = { name: "right-syntax" };
const AT_660 = { klass: _tokenizer.TokenClass.Punctuator, name: "@" };
const literalKeywords_661 = ["this", "null", "true", "false"];
const isLeftBracket_662 = R.whereEq({ type: _tokenizer.TokenType.LBRACK });
const isLeftBrace_663 = R.whereEq({ type: _tokenizer.TokenType.LBRACE });
const isLeftParen_664 = R.whereEq({ type: _tokenizer.TokenType.LPAREN });
const isRightBracket_665 = R.whereEq({ type: _tokenizer.TokenType.RBRACK });
const isRightBrace_666 = R.whereEq({ type: _tokenizer.TokenType.RBRACE });
const isRightParen_667 = R.whereEq({ type: _tokenizer.TokenType.RPAREN });
const isEOS_668 = R.whereEq({ type: _tokenizer.TokenType.EOS });
const isHash_669 = R.whereEq({ type: _tokenizer.TokenType.IDENTIFIER, value: "#" });
const isLeftSyntax_670 = R.whereEq({ type: LSYNTAX_658 });
const isRightSyntax_671 = R.whereEq({ type: RSYNTAX_659 });
const isLeftDelimiter_672 = R.anyPass([isLeftBracket_662, isLeftBrace_663, isLeftParen_664, isLeftSyntax_670]);
const isRightDelimiter_673 = R.anyPass([isRightBracket_665, isRightBrace_666, isRightParen_667, isRightSyntax_671]);
const isMatchingDelimiters_674 = R.cond([[isLeftBracket_662, (__715, b_716) => isRightBracket_665(b_716)], [isLeftBrace_663, (__717, b_718) => isRightBrace_666(b_718)], [isLeftParen_664, (__719, b_720) => isRightParen_667(b_720)], [isLeftSyntax_670, (__721, b_722) => isRightSyntax_671(b_722)], [R.T, R.F]]);
const assignOps_675 = ["=", "+=", "-=", "*=", "/=", "%=", "<<=", ">>=", ">>>=", "&=", "|=", "^=", ","];
const binaryOps_676 = ["+", "-", "*", "/", "%", "<<", ">>", ">>>", "&", "|", "^", "&&", "||", "?", ":", "===", "==", ">=", "<=", "<", ">", "!=", "!==", "instanceof"];
const unaryOps_677 = ["++", "--", "~", "!", "delete", "void", "typeof", "yield", "throw", "new"];
const isEmpty_678 = R.whereEq({ size: 0 });
const isPunctuator_679 = s_723 => s_723.match("punctuator");
const isKeyword_680 = s_724 => s_724.match("keyword");
const isDelimiter_681 = s_725 => s_725.match("delimiter");
const isParens_682 = s_726 => s_726.match("parens");
const isBraces_683 = s_727 => s_727.match("braces");
const isBrackets_684 = s_728 => s_728.match("brackets");
const isIdentifier_685 = s_729 => s_729.match("identifier");
const val_686 = s_730 => s_730.val();
const isVal_687 = R.curry((v_731, s_732) => s_732.val() === v_731);
const isDot_688 = R.allPass([isPunctuator_679, isVal_687(".")]);
const isColon_689 = R.allPass([isPunctuator_679, isVal_687(":")]);
const isFunctionKeyword_690 = R.allPass([isKeyword_680, isVal_687("function")]);
const isOperator_691 = s_733 => (s_733.match("punctuator") || s_733.match("keyword")) && R.any(R.equals(s_733.val()), assignOps_675.concat(binaryOps_676).concat(unaryOps_677));
const isNonLiteralKeyword_692 = R.allPass([isKeyword_680, s_734 => R.none(R.equals(s_734.val()), literalKeywords_661)]);
const isKeywordExprPrefix_693 = R.allPass([isKeyword_680, s_735 => R.any(R.equals(s_735.val()), ["instanceof", "typeof", "delete", "void", "yield", "throw", "new", "case"])]);
let last_694 = p_736 => p_736.last();
let safeLast_695 = R.pipe(R.cond([[isEmpty_678, R.always(Nothing_657())], [R.T, R.compose(_ramdaFantasy.Maybe.of, last_694)]]));
let stuffTrue_696 = R.curry((p_737, b_738) => b_738 ? Just_656(p_737) : Nothing_657());
let stuffFalse_697 = R.curry((p_739, b_740) => !b_740 ? Just_656(p_739) : Nothing_657());
let isTopColon_698 = R.pipe(safeLast_695, R.map(isColon_689), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isTopPunctuator_699 = R.pipe(safeLast_695, R.map(isPunctuator_679), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isExprReturn_700 = R.curry((l_741, p_742) => {
  let retKwd_743 = safeLast_695(p_742);
  let maybeDot_744 = pop_711(p_742).chain(safeLast_695);
  if (maybeDot_744.map(isDot_688).getOrElse(false)) {
    return true;
  }
  return retKwd_743.map(s_745 => {
    return s_745.match("keyword") && s_745.val() === "return" && s_745.lineNumber() === l_741;
  }).getOrElse(false);
});
const isTopOperator_701 = R.pipe(safeLast_695, R.map(isOperator_691), _ramdaFantasy.Maybe.maybe(false, R.identity));
const isTopKeywordExprPrefix_702 = R.pipe(safeLast_695, R.map(isKeywordExprPrefix_693), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isExprPrefix_703 = R.curry((l_746, b_747) => R.cond([[isEmpty_678, R.always(b_747)], [isTopColon_698, R.always(b_747)], [isTopKeywordExprPrefix_702, R.T], [isTopOperator_701, R.T], [isTopPunctuator_699, R.always(b_747)], [isExprReturn_700(l_746), R.T], [R.T, R.F]]));
let curly_704 = p_748 => safeLast_695(p_748).map(isBraces_683).chain(stuffTrue_696(p_748));
let paren_705 = p_749 => safeLast_695(p_749).map(isParens_682).chain(stuffTrue_696(p_749));
let func_706 = p_750 => safeLast_695(p_750).map(isFunctionKeyword_690).chain(stuffTrue_696(p_750));
let ident_707 = p_751 => safeLast_695(p_751).map(isIdentifier_685).chain(stuffTrue_696(p_751));
let nonLiteralKeyword_708 = p_752 => safeLast_695(p_752).map(isNonLiteralKeyword_692).chain(stuffTrue_696(p_752));
let opt_709 = R.curry((a_753, b_754, p_755) => {
  let result_756 = R.pipeK(a_753, b_754)(_ramdaFantasy.Maybe.of(p_755));
  return _ramdaFantasy.Maybe.isJust(result_756) ? result_756 : _ramdaFantasy.Maybe.of(p_755);
});
let notDot_710 = R.ifElse(R.whereEq({ size: 0 }), Just_656, p_757 => safeLast_695(p_757).map(s_758 => !(s_758.match("punctuator") && s_758.val() === ".")).chain(stuffTrue_696(p_757)));
let pop_711 = R.compose(Just_656, p_759 => p_759.pop());
const functionPrefix_712 = R.pipeK(curly_704, pop_711, paren_705, pop_711, opt_709(ident_707, pop_711), func_706);
const isRegexPrefix_713 = b_760 => R.anyPass([isEmpty_678, isTopPunctuator_699, R.pipe(_ramdaFantasy.Maybe.of, R.pipeK(nonLiteralKeyword_708, pop_711, notDot_710), _ramdaFantasy.Maybe.isJust), R.pipe(_ramdaFantasy.Maybe.of, R.pipeK(paren_705, pop_711, nonLiteralKeyword_708, pop_711, notDot_710), _ramdaFantasy.Maybe.isJust), R.pipe(_ramdaFantasy.Maybe.of, functionPrefix_712, R.chain(p_761 => {
  return safeLast_695(p_761).map(s_762 => s_762.lineNumber()).chain(fnLine_763 => {
    return pop_711(p_761).map(isExprPrefix_703(fnLine_763, b_760));
  }).chain(stuffFalse_697(p_761));
}), _ramdaFantasy.Maybe.isJust), p_764 => {
  let isCurly_765 = _ramdaFantasy.Maybe.isJust(safeLast_695(p_764).map(isBraces_683));
  let alreadyCheckedFunction_766 = R.pipe(_ramdaFantasy.Maybe.of, functionPrefix_712, _ramdaFantasy.Maybe.isJust)(p_764);
  if (alreadyCheckedFunction_766) {
    return false;
  }
  return R.pipe(_ramdaFantasy.Maybe.of, R.chain(curly_704), R.chain(p_767 => {
    return safeLast_695(p_767).map(s_768 => s_768.lineNumber()).chain(curlyLine_769 => {
      return pop_711(p_767).map(isExprPrefix_703(curlyLine_769, b_760));
    }).chain(stuffFalse_697(p_767));
  }), _ramdaFantasy.Maybe.isJust)(p_764);
}]);
function lastEl_714(l_770) {
  return l_770[l_770.length - 1];
}
class Reader extends _tokenizer2.default {
  constructor(strings_771, context_772, replacements_773) {
    super(Array.isArray(strings_771) ? strings_771.join("") : strings_771);
    this.delimStack = new Map();
    this.insideSyntaxTemplate = [false];
    this.context = context_772;
    if (Array.isArray(strings_771)) {
      let totalIndex = 0;
      this.replacementIndex = R.reduce((acc_774, strRep_775) => {
        acc_774.push({ index: totalIndex + strRep_775[0].length, replacement: strRep_775[1] });
        totalIndex += strRep_775[0].length;
        return acc_774;
      }, [], R.zip(strings_771, replacements_773));
    }
  }
  read() {
    let stack_776 = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];
    let b_777 = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];
    let singleDelimiter_778 = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];

    let prefix_779 = (0, _immutable.List)();
    while (true) {
      let tok = this.advance(prefix_779, b_777);
      if (tok.scopesets || tok instanceof _terms2.default) {
        stack_776.push(tok);
        continue;
      }
      if (Array.isArray(tok)) {
        Array.prototype.push.apply(stack_776, tok);
        continue;
      }
      if (_immutable.List.isList(tok)) {
        Array.prototype.push.apply(stack_776, tok.toArray());
        continue;
      }
      if (isEOS_668(tok)) {
        if (stack_776[0] && isLeftDelimiter_672(stack_776[0].token)) {
          throw this.createUnexpected(tok);
        }
        break;
      }
      if (isLeftDelimiter_672(tok)) {
        if (isLeftSyntax_670(tok)) {
          this.insideSyntaxTemplate.push(true);
        }
        let line = tok.slice.startLocation.line;
        let innerB = isLeftBrace_663(tok) ? isExprPrefix_703(line, b_777)(prefix_779) : true;
        let inner = this.read([new _syntax2.default(tok, this.context)], innerB, false);
        let stx = new _syntax2.default(inner, this.context);
        prefix_779 = prefix_779.concat(stx);
        stack_776.push(stx);
        if (singleDelimiter_778) {
          break;
        }
      } else if (isRightDelimiter_673(tok)) {
        if (stack_776[0] && !isMatchingDelimiters_674(stack_776[0].token, tok)) {
          throw this.createUnexpected(tok);
        }
        let stx = new _syntax2.default(tok, this.context);
        stack_776.push(stx);
        if (lastEl_714(this.insideSyntaxTemplate) && isRightSyntax_671(tok)) {
          this.insideSyntaxTemplate.pop();
        }
        break;
      } else {
        let stx = new _syntax2.default(tok, this.context);
        prefix_779 = prefix_779.concat(stx);
        stack_776.push(stx);
      }
    }
    return (0, _immutable.List)(stack_776);
  }
  advance(prefix_780, b_781) {
    let startLocation_782 = this.getLocation();
    this.lastIndex = this.index;
    this.lastLine = this.line;
    this.lastLineStart = this.lineStart;
    this.skipComment();
    this.startIndex = this.index;
    this.startLine = this.line;
    this.startLineStart = this.lineStart;
    if (this.replacementIndex && this.replacementIndex[0] && this.index >= this.replacementIndex[0].index) {
      let rep = this.replacementIndex[0].replacement;
      this.replacementIndex.shift();
      return rep;
    }
    let charCode_783 = this.source.charCodeAt(this.index);
    if (charCode_783 === 96) {
      let element,
          items = [];
      let startLocation_782 = this.getLocation();
      let start = this.index;
      this.index++;
      if (lastEl_714(this.insideSyntaxTemplate)) {
        let slice = this.getSlice(start, startLocation_782);
        return { type: RSYNTAX_659, value: "`", slice: slice };
      }
      do {
        element = this.scanTemplateElement();
        items.push(element);
        if (element.interp) {
          element = this.read([], false, true);
          (0, _errors.assert)(element.size === 1, "should only have read a single delimiter inside a template");
          items.push(element.get(0));
        }
      } while (!element.tail);
      return { type: _tokenizer.TokenType.TEMPLATE, items: (0, _immutable.List)(items), slice: this.getSlice(start, startLocation_782) };
    } else if (charCode_783 === 35) {
      let startLocation_782 = this.getLocation();
      let start = this.index;
      let slice = this.getSlice(start, startLocation_782);
      this.index++;
      if (this.source.charCodeAt(this.index) === 96) {
        this.index++;
        return { type: LSYNTAX_658, value: "#`", slice: slice };
      }
      return { type: _tokenizer.TokenType.IDENTIFIER, value: "#", slice: slice };
    } else if (charCode_783 === 64) {
      let startLocation_782 = this.getLocation();
      let start = this.index;
      let slice = this.getSlice(start, startLocation_782);
      this.index++;
      return { type: AT_660, value: "@", slice: slice };
    }
    let lookahead_784 = super.advance();
    if (lookahead_784.type === _tokenizer.TokenType.DIV && isRegexPrefix_713(b_781)(prefix_780)) {
      return super.scanRegExp("/");
    }
    return lookahead_784;
  }
  scanTemplateElement() {
    let startLocation_785 = this.getLocation();
    let start_786 = this.index;
    while (this.index < this.source.length) {
      let ch = this.source.charCodeAt(this.index);
      switch (ch) {
        case 96:
          let slice = this.getSlice(start_786, startLocation_785);
          this.index++;
          return { type: _tokenizer.TokenType.TEMPLATE, tail: true, interp: false, slice: slice };
        case 36:
          if (this.source.charCodeAt(this.index + 1) === 123) {
            let slice = this.getSlice(start_786, startLocation_785);
            this.index += 1;
            return { type: _tokenizer.TokenType.TEMPLATE, tail: false, interp: true, slice: slice };
          }
          this.index++;
          break;
        case 92:
          {
            let octal = this.scanStringEscape("", null)[1];
            if (octal != null) {
              throw this.createILLEGAL();
            }
            break;
          }
        default:
          this.index++;
      }
    }
    throw this.createILLEGAL();
  }
}
exports.default = Reader;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3N3ZWV0L3NoaWZ0LXJlYWRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUVBOztBQUNBOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7SUFBYSxDOzs7Ozs7QUFDYixNQUFNLFdBQVcsb0JBQU0sSUFBdkI7QUFDQSxNQUFNLGNBQWMsb0JBQU0sT0FBMUI7QUFDQSxNQUFNLGNBQWMsRUFBQyxNQUFNLGFBQVAsRUFBcEI7QUFDQSxNQUFNLGNBQWMsRUFBQyxNQUFNLGNBQVAsRUFBcEI7QUFDQSxNQUFNLFNBQVMsRUFBQyxPQUFPLHNCQUFXLFVBQW5CLEVBQStCLE1BQU0sR0FBckMsRUFBZjtBQUNBLE1BQU0sc0JBQXNCLENBQUMsTUFBRCxFQUFTLE1BQVQsRUFBaUIsTUFBakIsRUFBeUIsT0FBekIsQ0FBNUI7QUFDQSxNQUFNLG9CQUFvQixFQUFFLE9BQUYsQ0FBVSxFQUFDLE1BQU0scUJBQVUsTUFBakIsRUFBVixDQUExQjtBQUNBLE1BQU0sa0JBQWtCLEVBQUUsT0FBRixDQUFVLEVBQUMsTUFBTSxxQkFBVSxNQUFqQixFQUFWLENBQXhCO0FBQ0EsTUFBTSxrQkFBa0IsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLE1BQWpCLEVBQVYsQ0FBeEI7QUFDQSxNQUFNLHFCQUFxQixFQUFFLE9BQUYsQ0FBVSxFQUFDLE1BQU0scUJBQVUsTUFBakIsRUFBVixDQUEzQjtBQUNBLE1BQU0sbUJBQW1CLEVBQUUsT0FBRixDQUFVLEVBQUMsTUFBTSxxQkFBVSxNQUFqQixFQUFWLENBQXpCO0FBQ0EsTUFBTSxtQkFBbUIsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLE1BQWpCLEVBQVYsQ0FBekI7QUFDQSxNQUFNLFlBQVksRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLEdBQWpCLEVBQVYsQ0FBbEI7QUFDQSxNQUFNLGFBQWEsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLFVBQWpCLEVB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aEQsRUFBc0QsT0FBTyxLQUE3RCxFQUFQO0FBQ0Q7QUFDRCxlQUFLLEtBQUw7QUFDQTtBQUNGLGFBQUssRUFBTDtBQUNFO0FBQ0UsZ0JBQUksUUFBUSxLQUFLLGdCQUFMLENBQXNCLEVBQXRCLEVBQTBCLElBQTFCLEVBQWdDLENBQWhDLENBQVo7QUFDQSxnQkFBSSxTQUFTLElBQWIsRUFBbUI7QUFDakIsb0JBQU0sS0FBSyxhQUFMLEVBQU47QUFDRDtBQUNEO0FBQ0Q7QUFDSDtBQUNFLGVBQUssS0FBTDtBQXRCSjtBQXdCRDtBQUNELFVBQU0sS0FBSyxhQUFMLEVBQU47QUFDRDtBQTVKMkM7a0JBQXpCLE0iLCJmaWxlIjoic2hpZnQtcmVhZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFRva2VuaXplciBmcm9tIFwic2hpZnQtcGFyc2VyL2Rpc3QvdG9rZW5pemVyXCI7XG5pbXBvcnQge1Rva2VuQ2xhc3MsIFRva2VuVHlwZX0gZnJvbSBcInNoaWZ0LXBhcnNlci9kaXN0L3Rva2VuaXplclwiO1xuaW1wb3J0IHtMaXN0fSBmcm9tIFwiaW1tdXRhYmxlXCI7XG5pbXBvcnQgU3ludGF4IGZyb20gXCIuL3N5bnRheFwiO1xuaW1wb3J0IHtNYXliZX0gZnJvbSBcInJhbWRhLWZhbnRhc3lcIjtcbmltcG9ydCB7YXNzZXJ0fSBmcm9tIFwiLi9lcnJvcnNcIjtcbmltcG9ydCBUZXJtIGZyb20gXCIuL3Rlcm1zXCI7XG5pbXBvcnQgICogYXMgUiBmcm9tIFwicmFtZGFcIjtcbmNvbnN0IEp1c3RfNjU2ID0gTWF5YmUuSnVzdDtcbmNvbnN0IE5vdGhpbmdfNjU3ID0gTWF5YmUuTm90aGluZztcbmNvbnN0IExTWU5UQVhfNjU4ID0ge25hbWU6IFwibGVmdC1zeW50YXhcIn07XG5jb25zdCBSU1lOVEFYXzY1OSA9IHtuYW1lOiBcInJpZ2h0LXN5bnRheFwifTtcbmNvbnN0IEFUXzY2MCA9IHtrbGFzczogVG9rZW5DbGFzcy5QdW5jdHVhdG9yLCBuYW1lOiBcIkBcIn07XG5jb25zdCBsaXRlcmFsS2V5d29yZHNfNjYxID0gW1widGhpc1wiLCBcIm51bGxcIiwgXCJ0cnVlXCIsIFwiZmFsc2VcIl07XG5jb25zdCBpc0xlZnRCcmFja2V0XzY2MiA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLkxCUkFDS30pO1xuY29uc3QgaXNMZWZ0QnJhY2VfNjYzID0gUi53aGVyZUVxKHt0eXBlOiBUb2tlblR5cGUuTEJSQUNFfSk7XG5jb25zdCBpc0xlZnRQYXJlbl82NjQgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5MUEFSRU59KTtcbmNvbnN0IGlzUmlnaHRCcmFja2V0XzY2NSA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLlJCUkFDS30pO1xuY29uc3QgaXNSaWdodEJyYWNlXzY2NiA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLlJCUkFDRX0pO1xuY29uc3QgaXNSaWdodFBhcmVuXzY2NyA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLlJQQVJFTn0pO1xuY29uc3QgaXNFT1NfNjY4ID0gUi53aGVyZUVxKHt0eXBlOiBUb2tlblR5cGUuRU9TfSk7XG5jb25zdCBpc0hhc2hfNjY5ID0gUi53aGVyZUVxKHt0eXBlOiBUb2tlblR5cGUuSURFTlRJRklFUiwgdmFsdWU6IFwiI1wifSk7XG5jb25zdCBpc0xlZnRTeW50YXhfNjcwID0gUi53aGVyZUVxKHt0eXBlOiBMU1lOVEFYXzY1OH0pO1xuY29uc3QgaXNSaWdodFN5bnRheF82NzEgPSBSLndoZXJlRXEoe3R5cGU6IFJTWU5UQVhfNjU5fSk7XG5jb25zdCBpc0xlZnREZWxpbWl0ZXJfNjcyID0gUi5hbnlQYXNzKFtpc0xlZnRCcmFja2V0XzY2MiwgaXNMZWZ0QnJhY2VfNjYzLCBpc0xlZnRQYXJlbl82NjQsIGlzTGVmdFN5bnRheF82NzBdKTtcbmNvbnN0IGlzUmlnaHREZWxpbWl0ZXJfNjczID0gUi5hbnlQYXNzKFtpc1JpZ2h0QnJhY2tldF82NjUsIGlzUmlnaHRCcmFjZV82NjYsIGlzUmlnaHRQYXJlbl82NjcsIGlzUmlnaHRTeW50YXhfNjcxXSk7XG5jb25zdCBpc01hdGNoaW5nRGVsaW1pdGVyc182NzQgPSBSLmNvbmQoW1tpc0xlZnRCcmFja2V0XzY2MiwgKF9fNzE1LCBiXzcxNikgPT4gaXNSaWdodEJyYWNrZXRfNjY1KGJfNzE2KV0sIFtpc0xlZnRCcmFjZV82NjMsIChfXzcxNywgYl83MTgpID0+IGlzUmlnaHRCcmFjZV82NjYoYl83MTgpXSwgW2lzTGVmdFBhcmVuXzY2NCwgKF9fNzE5LCBiXzcyMCkgPT4gaXNSaWdodFBhcmVuXzY2NyhiXzcyMCldLCBbaXNMZWZ0U3ludGF4XzY3MCwgKF9fNzIxLCBiXzcyMikgPT4gaXNSaWdodFN5bnRheF82NzEoYl83MjIpXSwgW1IuVCwgUi5GXV0pO1xuY29uc3QgYXNzaWduT3BzXzY3NSA9IFtcIj1cIiwgXCIrPVwiLCBcIi09XCIsIFwiKj1cIiwgXCIvPVwiLCBcIiU9XCIsIFwiPDw9XCIsIFwiPj49XCIsIFwiPj4+PVwiLCBcIiY9XCIsIFwifD1cIiwgXCJePVwiLCBcIixcIl07XG5jb25zdCBiaW5hcnlPcHNfNjc2ID0gW1wiK1wiLCBcIi1cIiwgXCIqXCIsIFwiL1wiLCBcIiVcIiwgXCI8PFwiLCBcIj4+XCIsIFwiPj4+XCIsIFwiJlwiLCBcInxcIiwgXCJeXCIsIFwiJiZcIiwgXCJ8fFwiLCBcIj9cIiwgXCI6XCIsIFwiPT09XCIsIFwiPT1cIiwgXCI+PVwiLCBcIjw9XCIsIFwiPFwiLCBcIj5cIiwgXCIhPVwiLCBcIiE9PVwiLCBcImluc3RhbmNlb2ZcIl07XG5jb25zdCB1bmFyeU9wc182NzcgPSBbXCIrK1wiLCBcIi0tXCIsIFwiflwiLCBcIiFcIiwgXCJkZWxldGVcIiwgXCJ2b2lkXCIsIFwidHlwZW9mXCIsIFwieWllbGRcIiwgXCJ0aHJvd1wiLCBcIm5ld1wiXTtcbmNvbnN0IGlzRW1wdHlfNjc4ID0gUi53aGVyZUVxKHtzaXplOiAwfSk7XG5jb25zdCBpc1B1bmN0dWF0b3JfNjc5ID0gc183MjMgPT4gc183MjMubWF0Y2goXCJwdW5jdHVhdG9yXCIpO1xuY29uc3QgaXNLZXl3b3JkXzY4MCA9IHNfNzI0ID0+IHNfNzI0Lm1hdGNoKFwia2V5d29yZFwiKTtcbmNvbnN0IGlzRGVsaW1pdGVyXzY4MSA9IHNfNzI1ID0+IHNfNzI1Lm1hdGNoKFwiZGVsaW1pdGVyXCIpO1xuY29uc3QgaXNQYXJlbnNfNjgyID0gc183MjYgPT4gc183MjYubWF0Y2goXCJwYXJlbnNcIik7XG5jb25zdCBpc0JyYWNlc182ODMgPSBzXzcyNyA9PiBzXzcyNy5tYXRjaChcImJyYWNlc1wiKTtcbmNvbnN0IGlzQnJhY2tldHNfNjg0ID0gc183MjggPT4gc183MjgubWF0Y2goXCJicmFja2V0c1wiKTtcbmNvbnN0IGlzSWRlbnRpZmllcl82ODUgPSBzXzcyOSA9PiBzXzcyOS5tYXRjaChcImlkZW50aWZpZXJcIik7XG5jb25zdCB2YWxfNjg2ID0gc183MzAgPT4gc183MzAudmFsKCk7XG5jb25zdCBpc1ZhbF82ODcgPSBSLmN1cnJ5KCh2XzczMSwgc183MzIpID0+IHNfNzMyLnZhbCgpID09PSB2XzczMSk7XG5jb25zdCBpc0RvdF82ODggPSBSLmFsbFBhc3MoW2lzUHVuY3R1YXRvcl82NzksIGlzVmFsXzY4NyhcIi5cIildKTtcbmNvbnN0IGlzQ29sb25fNjg5ID0gUi5hbGxQYXNzKFtpc1B1bmN0dWF0b3JfNjc5LCBpc1ZhbF82ODcoXCI6XCIpXSk7XG5jb25zdCBpc0Z1bmN0aW9uS2V5d29yZF82OTAgPSBSLmFsbFBhc3MoW2lzS2V5d29yZF82ODAsIGlzVmFsXzY4NyhcImZ1bmN0aW9uXCIpXSk7XG5jb25zdCBpc09wZXJhdG9yXzY5MSA9IHNfNzMzID0+IChzXzczMy5tYXRjaChcInB1bmN0dWF0b3JcIikgfHwgc183MzMubWF0Y2goXCJrZXl3b3JkXCIpKSAmJiBSLmFueShSLmVxdWFscyhzXzczMy52YWwoKSksIGFzc2lnbk9wc182NzUuY29uY2F0KGJpbmFyeU9wc182NzYpLmNvbmNhdCh1bmFyeU9wc182NzcpKTtcbmNvbnN0IGlzTm9uTGl0ZXJhbEtleXdvcmRfNjkyID0gUi5hbGxQYXNzKFtpc0tleXdvcmRfNjgwLCBzXzczNCA9PiBSLm5vbmUoUi5lcXVhbHMoc183MzQudmFsKCkpLCBsaXRlcmFsS2V5d29yZHNfNjYxKV0pO1xuY29uc3QgaXNLZXl3b3JkRXhwclByZWZpeF82OTMgPSBSLmFsbFBhc3MoW2lzS2V5d29yZF82ODAsIHNfNzM1ID0+IFIuYW55KFIuZXF1YWxzKHNfNzM1LnZhbCgpKSwgW1wiaW5zdGFuY2VvZlwiLCBcInR5cGVvZlwiLCBcImRlbGV0ZVwiLCBcInZvaWRcIiwgXCJ5aWVsZFwiLCBcInRocm93XCIsIFwibmV3XCIsIFwiY2FzZVwiXSldKTtcbmxldCBsYXN0XzY5NCA9IHBfNzM2ID0+IHBfNzM2Lmxhc3QoKTtcbmxldCBzYWZlTGFzdF82OTUgPSBSLnBpcGUoUi5jb25kKFtbaXNFbXB0eV82NzgsIFIuYWx3YXlzKE5vdGhpbmdfNjU3KCkpXSwgW1IuVCwgUi5jb21wb3NlKE1heWJlLm9mLCBsYXN0XzY5NCldXSkpO1xubGV0IHN0dWZmVHJ1ZV82OTYgPSBSLmN1cnJ5KChwXzczNywgYl83MzgpID0+IGJfNzM4ID8gSnVzdF82NTYocF83MzcpIDogTm90aGluZ182NTcoKSk7XG5sZXQgc3R1ZmZGYWxzZV82OTcgPSBSLmN1cnJ5KChwXzczOSwgYl83NDApID0+ICFiXzc0MCA/IEp1c3RfNjU2KHBfNzM5KSA6IE5vdGhpbmdfNjU3KCkpO1xubGV0IGlzVG9wQ29sb25fNjk4ID0gUi5waXBlKHNhZmVMYXN0XzY5NSwgUi5tYXAoaXNDb2xvbl82ODkpLCBNYXliZS5tYXliZShmYWxzZSwgUi5pZGVudGl0eSkpO1xubGV0IGlzVG9wUHVuY3R1YXRvcl82OTkgPSBSLnBpcGUoc2FmZUxhc3RfNjk1LCBSLm1hcChpc1B1bmN0dWF0b3JfNjc5KSwgTWF5YmUubWF5YmUoZmFsc2UsIFIuaWRlbnRpdHkpKTtcbmxldCBpc0V4cHJSZXR1cm5fNzAwID0gUi5jdXJyeSgobF83NDEsIHBfNzQyKSA9PiB7XG4gIGxldCByZXRLd2RfNzQzID0gc2FmZUxhc3RfNjk1KHBfNzQyKTtcbiAgbGV0IG1heWJlRG90Xzc0NCA9IHBvcF83MTEocF83NDIpLmNoYWluKHNhZmVMYXN0XzY5NSk7XG4gIGlmIChtYXliZURvdF83NDQubWFwKGlzRG90XzY4OCkuZ2V0T3JFbHNlKGZhbHNlKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiByZXRLd2RfNzQzLm1hcChzXzc0NSA9PiB7XG4gICAgcmV0dXJuIHNfNzQ1Lm1hdGNoKFwia2V5d29yZFwiKSAmJiBzXzc0NS52YWwoKSA9PT0gXCJyZXR1cm5cIiAmJiBzXzc0NS5saW5lTnVtYmVyKCkgPT09IGxfNzQxO1xuICB9KS5nZXRPckVsc2UoZmFsc2UpO1xufSk7XG5jb25zdCBpc1RvcE9wZXJhdG9yXzcwMSA9IFIucGlwZShzYWZlTGFzdF82OTUsIFIubWFwKGlzT3BlcmF0b3JfNjkxKSwgTWF5YmUubWF5YmUoZmFsc2UsIFIuaWRlbnRpdHkpKTtcbmNvbnN0IGlzVG9wS2V5d29yZEV4cHJQcmVmaXhfNzAyID0gUi5waXBlKHNhZmVMYXN0XzY5NSwgUi5tYXAoaXNLZXl3b3JkRXhwclByZWZpeF82OTMpLCBNYXliZS5tYXliZShmYWxzZSwgUi5pZGVudGl0eSkpO1xubGV0IGlzRXhwclByZWZpeF83MDMgPSBSLmN1cnJ5KChsXzc0NiwgYl83NDcpID0+IFIuY29uZChbW2lzRW1wdHlfNjc4LCBSLmFsd2F5cyhiXzc0NyldLCBbaXNUb3BDb2xvbl82OTgsIFIuYWx3YXlzKGJfNzQ3KV0sIFtpc1RvcEtleXdvcmRFeHByUHJlZml4XzcwMiwgUi5UXSwgW2lzVG9wT3BlcmF0b3JfNzAxLCBSLlRdLCBbaXNUb3BQdW5jdHVhdG9yXzY5OSwgUi5hbHdheXMoYl83NDcpXSwgW2lzRXhwclJldHVybl83MDAobF83NDYpLCBSLlRdLCBbUi5ULCBSLkZdXSkpO1xubGV0IGN1cmx5XzcwNCA9IHBfNzQ4ID0+IHNhZmVMYXN0XzY5NShwXzc0OCkubWFwKGlzQnJhY2VzXzY4MykuY2hhaW4oc3R1ZmZUcnVlXzY5NihwXzc0OCkpO1xubGV0IHBhcmVuXzcwNSA9IHBfNzQ5ID0+IHNhZmVMYXN0XzY5NShwXzc0OSkubWFwKGlzUGFyZW5zXzY4MikuY2hhaW4oc3R1ZmZUcnVlXzY5NihwXzc0OSkpO1xubGV0IGZ1bmNfNzA2ID0gcF83NTAgPT4gc2FmZUxhc3RfNjk1KHBfNzUwKS5tYXAoaXNGdW5jdGlvbktleXdvcmRfNjkwKS5jaGFpbihzdHVmZlRydWVfNjk2KHBfNzUwKSk7XG5sZXQgaWRlbnRfNzA3ID0gcF83NTEgPT4gc2FmZUxhc3RfNjk1KHBfNzUxKS5tYXAoaXNJZGVudGlmaWVyXzY4NSkuY2hhaW4oc3R1ZmZUcnVlXzY5NihwXzc1MSkpO1xubGV0IG5vbkxpdGVyYWxLZXl3b3JkXzcwOCA9IHBfNzUyID0+IHNhZmVMYXN0XzY5NShwXzc1MikubWFwKGlzTm9uTGl0ZXJhbEtleXdvcmRfNjkyKS5jaGFpbihzdHVmZlRydWVfNjk2KHBfNzUyKSk7XG5sZXQgb3B0XzcwOSA9IFIuY3VycnkoKGFfNzUzLCBiXzc1NCwgcF83NTUpID0+IHtcbiAgbGV0IHJlc3VsdF83NTYgPSBSLnBpcGVLKGFfNzUzLCBiXzc1NCkoTWF5YmUub2YocF83NTUpKTtcbiAgcmV0dXJuIE1heWJlLmlzSnVzdChyZXN1bHRfNzU2KSA/IHJlc3VsdF83NTYgOiBNYXliZS5vZihwXzc1NSk7XG59KTtcbmxldCBub3REb3RfNzEwID0gUi5pZkVsc2UoUi53aGVyZUVxKHtzaXplOiAwfSksIEp1c3RfNjU2LCBwXzc1NyA9PiBzYWZlTGFzdF82OTUocF83NTcpLm1hcChzXzc1OCA9PiAhKHNfNzU4Lm1hdGNoKFwicHVuY3R1YXRvclwiKSAmJiBzXzc1OC52YWwoKSA9PT0gXCIuXCIpKS5jaGFpbihzdHVmZlRydWVfNjk2KHBfNzU3KSkpO1xubGV0IHBvcF83MTEgPSBSLmNvbXBvc2UoSnVzdF82NTYsIHBfNzU5ID0+IHBfNzU5LnBvcCgpKTtcbmNvbnN0IGZ1bmN0aW9uUHJlZml4XzcxMiA9IFIucGlwZUsoY3VybHlfNzA0LCBwb3BfNzExLCBwYXJlbl83MDUsIHBvcF83MTEsIG9wdF83MDkoaWRlbnRfNzA3LCBwb3BfNzExKSwgZnVuY183MDYpO1xuY29uc3QgaXNSZWdleFByZWZpeF83MTMgPSBiXzc2MCA9PiBSLmFueVBhc3MoW2lzRW1wdHlfNjc4LCBpc1RvcFB1bmN0dWF0b3JfNjk5LCBSLnBpcGUoTWF5YmUub2YsIFIucGlwZUsobm9uTGl0ZXJhbEtleXdvcmRfNzA4LCBwb3BfNzExLCBub3REb3RfNzEwKSwgTWF5YmUuaXNKdXN0KSwgUi5waXBlKE1heWJlLm9mLCBSLnBpcGVLKHBhcmVuXzcwNSwgcG9wXzcxMSwgbm9uTGl0ZXJhbEtleXdvcmRfNzA4LCBwb3BfNzExLCBub3REb3RfNzEwKSwgTWF5YmUuaXNKdXN0KSwgUi5waXBlKE1heWJlLm9mLCBmdW5jdGlvblByZWZpeF83MTIsIFIuY2hhaW4ocF83NjEgPT4ge1xuICByZXR1cm4gc2FmZUxhc3RfNjk1KHBfNzYxKS5tYXAoc183NjIgPT4gc183NjIubGluZU51bWJlcigpKS5jaGFpbihmbkxpbmVfNzYzID0+IHtcbiAgICByZXR1cm4gcG9wXzcxMShwXzc2MSkubWFwKGlzRXhwclByZWZpeF83MDMoZm5MaW5lXzc2MywgYl83NjApKTtcbiAgfSkuY2hhaW4oc3R1ZmZGYWxzZV82OTcocF83NjEpKTtcbn0pLCBNYXliZS5pc0p1c3QpLCBwXzc2NCA9PiB7XG4gIGxldCBpc0N1cmx5Xzc2NSA9IE1heWJlLmlzSnVzdChzYWZlTGFzdF82OTUocF83NjQpLm1hcChpc0JyYWNlc182ODMpKTtcbiAgbGV0IGFscmVhZHlDaGVja2VkRnVuY3Rpb25fNzY2ID0gUi5waXBlKE1heWJlLm9mLCBmdW5jdGlvblByZWZpeF83MTIsIE1heWJlLmlzSnVzdCkocF83NjQpO1xuICBpZiAoYWxyZWFkeUNoZWNrZWRGdW5jdGlvbl83NjYpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIFIucGlwZShNYXliZS5vZiwgUi5jaGFpbihjdXJseV83MDQpLCBSLmNoYWluKHBfNzY3ID0+IHtcbiAgICByZXR1cm4gc2FmZUxhc3RfNjk1KHBfNzY3KS5tYXAoc183NjggPT4gc183NjgubGluZU51bWJlcigpKS5jaGFpbihjdXJseUxpbmVfNzY5ID0+IHtcbiAgICAgIHJldHVybiBwb3BfNzExKHBfNzY3KS5tYXAoaXNFeHByUHJlZml4XzcwMyhjdXJseUxpbmVfNzY5LCBiXzc2MCkpO1xuICAgIH0pLmNoYWluKHN0dWZmRmFsc2VfNjk3KHBfNzY3KSk7XG4gIH0pLCBNYXliZS5pc0p1c3QpKHBfNzY0KTtcbn1dKTtcbmZ1bmN0aW9uIGxhc3RFbF83MTQobF83NzApIHtcbiAgcmV0dXJuIGxfNzcwW2xfNzcwLmxlbmd0aCAtIDFdO1xufVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVhZGVyIGV4dGVuZHMgVG9rZW5pemVyIHtcbiAgY29uc3RydWN0b3Ioc3RyaW5nc183NzEsIGNvbnRleHRfNzcyLCByZXBsYWNlbWVudHNfNzczKSB7XG4gICAgc3VwZXIoQXJyYXkuaXNBcnJheShzdHJpbmdzXzc3MSkgPyBzdHJpbmdzXzc3MS5qb2luKFwiXCIpIDogc3RyaW5nc183NzEpO1xuICAgIHRoaXMuZGVsaW1TdGFjayA9IG5ldyBNYXA7XG4gICAgdGhpcy5pbnNpZGVTeW50YXhUZW1wbGF0ZSA9IFtmYWxzZV07XG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dF83NzI7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoc3RyaW5nc183NzEpKSB7XG4gICAgICBsZXQgdG90YWxJbmRleCA9IDA7XG4gICAgICB0aGlzLnJlcGxhY2VtZW50SW5kZXggPSBSLnJlZHVjZSgoYWNjXzc3NCwgc3RyUmVwXzc3NSkgPT4ge1xuICAgICAgICBhY2NfNzc0LnB1c2goe2luZGV4OiB0b3RhbEluZGV4ICsgc3RyUmVwXzc3NVswXS5sZW5ndGgsIHJlcGxhY2VtZW50OiBzdHJSZXBfNzc1WzFdfSk7XG4gICAgICAgIHRvdGFsSW5kZXggKz0gc3RyUmVwXzc3NVswXS5sZW5ndGg7XG4gICAgICAgIHJldHVybiBhY2NfNzc0O1xuICAgICAgfSwgW10sIFIuemlwKHN0cmluZ3NfNzcxLCByZXBsYWNlbWVudHNfNzczKSk7XG4gICAgfVxuICB9XG4gIHJlYWQoc3RhY2tfNzc2ID0gW10sIGJfNzc3ID0gZmFsc2UsIHNpbmdsZURlbGltaXRlcl83NzggPSBmYWxzZSkge1xuICAgIGxldCBwcmVmaXhfNzc5ID0gTGlzdCgpO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBsZXQgdG9rID0gdGhpcy5hZHZhbmNlKHByZWZpeF83NzksIGJfNzc3KTtcbiAgICAgIGlmICh0b2suc2NvcGVzZXRzIHx8IHRvayBpbnN0YW5jZW9mIFRlcm0pIHtcbiAgICAgICAgc3RhY2tfNzc2LnB1c2godG9rKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0b2spKSB7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHN0YWNrXzc3NiwgdG9rKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoTGlzdC5pc0xpc3QodG9rKSkge1xuICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShzdGFja183NzYsIHRvay50b0FycmF5KCkpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0VPU182NjgodG9rKSkge1xuICAgICAgICBpZiAoc3RhY2tfNzc2WzBdICYmIGlzTGVmdERlbGltaXRlcl82NzIoc3RhY2tfNzc2WzBdLnRva2VuKSkge1xuICAgICAgICAgIHRocm93IHRoaXMuY3JlYXRlVW5leHBlY3RlZCh0b2spO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKGlzTGVmdERlbGltaXRlcl82NzIodG9rKSkge1xuICAgICAgICBpZiAoaXNMZWZ0U3ludGF4XzY3MCh0b2spKSB7XG4gICAgICAgICAgdGhpcy5pbnNpZGVTeW50YXhUZW1wbGF0ZS5wdXNoKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBsaW5lID0gdG9rLnNsaWNlLnN0YXJ0TG9jYXRpb24ubGluZTtcbiAgICAgICAgbGV0IGlubmVyQiA9IGlzTGVmdEJyYWNlXzY2Myh0b2spID8gaXNFeHByUHJlZml4XzcwMyhsaW5lLCBiXzc3NykocHJlZml4Xzc3OSkgOiB0cnVlO1xuICAgICAgICBsZXQgaW5uZXIgPSB0aGlzLnJlYWQoW25ldyBTeW50YXgodG9rLCB0aGlzLmNvbnRleHQpXSwgaW5uZXJCLCBmYWxzZSk7XG4gICAgICAgIGxldCBzdHggPSBuZXcgU3ludGF4KGlubmVyLCB0aGlzLmNvbnRleHQpO1xuICAgICAgICBwcmVmaXhfNzc5ID0gcHJlZml4Xzc3OS5jb25jYXQoc3R4KTtcbiAgICAgICAgc3RhY2tfNzc2LnB1c2goc3R4KTtcbiAgICAgICAgaWYgKHNpbmdsZURlbGltaXRlcl83NzgpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChpc1JpZ2h0RGVsaW1pdGVyXzY3Myh0b2spKSB7XG4gICAgICAgIGlmIChzdGFja183NzZbMF0gJiYgIWlzTWF0Y2hpbmdEZWxpbWl0ZXJzXzY3NChzdGFja183NzZbMF0udG9rZW4sIHRvaykpIHtcbiAgICAgICAgICB0aHJvdyB0aGlzLmNyZWF0ZVVuZXhwZWN0ZWQodG9rKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc3R4ID0gbmV3IFN5bnRheCh0b2ssIHRoaXMuY29udGV4dCk7XG4gICAgICAgIHN0YWNrXzc3Ni5wdXNoKHN0eCk7XG4gICAgICAgIGlmIChsYXN0RWxfNzE0KHRoaXMuaW5zaWRlU3ludGF4VGVtcGxhdGUpICYmIGlzUmlnaHRTeW50YXhfNjcxKHRvaykpIHtcbiAgICAgICAgICB0aGlzLmluc2lkZVN5bnRheFRlbXBsYXRlLnBvcCgpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHN0eCA9IG5ldyBTeW50YXgodG9rLCB0aGlzLmNvbnRleHQpO1xuICAgICAgICBwcmVmaXhfNzc5ID0gcHJlZml4Xzc3OS5jb25jYXQoc3R4KTtcbiAgICAgICAgc3RhY2tfNzc2LnB1c2goc3R4KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIExpc3Qoc3RhY2tfNzc2KTtcbiAgfVxuICBhZHZhbmNlKHByZWZpeF83ODAsIGJfNzgxKSB7XG4gICAgbGV0IHN0YXJ0TG9jYXRpb25fNzgyID0gdGhpcy5nZXRMb2NhdGlvbigpO1xuICAgIHRoaXMubGFzdEluZGV4ID0gdGhpcy5pbmRleDtcbiAgICB0aGlzLmxhc3RMaW5lID0gdGhpcy5saW5lO1xuICAgIHRoaXMubGFzdExpbmVTdGFydCA9IHRoaXMubGluZVN0YXJ0O1xuICAgIHRoaXMuc2tpcENvbW1lbnQoKTtcbiAgICB0aGlzLnN0YXJ0SW5kZXggPSB0aGlzLmluZGV4O1xuICAgIHRoaXMuc3RhcnRMaW5lID0gdGhpcy5saW5lO1xuICAgIHRoaXMuc3RhcnRMaW5lU3RhcnQgPSB0aGlzLmxpbmVTdGFydDtcbiAgICBpZiAodGhpcy5yZXBsYWNlbWVudEluZGV4ICYmIHRoaXMucmVwbGFjZW1lbnRJbmRleFswXSAmJiB0aGlzLmluZGV4ID49IHRoaXMucmVwbGFjZW1lbnRJbmRleFswXS5pbmRleCkge1xuICAgICAgbGV0IHJlcCA9IHRoaXMucmVwbGFjZW1lbnRJbmRleFswXS5yZXBsYWNlbWVudDtcbiAgICAgIHRoaXMucmVwbGFjZW1lbnRJbmRleC5zaGlmdCgpO1xuICAgICAgcmV0dXJuIHJlcDtcbiAgICB9XG4gICAgbGV0IGNoYXJDb2RlXzc4MyA9IHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy5pbmRleCk7XG4gICAgaWYgKGNoYXJDb2RlXzc4MyA9PT0gOTYpIHtcbiAgICAgIGxldCBlbGVtZW50LCBpdGVtcyA9IFtdO1xuICAgICAgbGV0IHN0YXJ0TG9jYXRpb25fNzgyID0gdGhpcy5nZXRMb2NhdGlvbigpO1xuICAgICAgbGV0IHN0YXJ0ID0gdGhpcy5pbmRleDtcbiAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgIGlmIChsYXN0RWxfNzE0KHRoaXMuaW5zaWRlU3ludGF4VGVtcGxhdGUpKSB7XG4gICAgICAgIGxldCBzbGljZSA9IHRoaXMuZ2V0U2xpY2Uoc3RhcnQsIHN0YXJ0TG9jYXRpb25fNzgyKTtcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBSU1lOVEFYXzY1OSwgdmFsdWU6IFwiYFwiLCBzbGljZTogc2xpY2V9O1xuICAgICAgfVxuICAgICAgZG8ge1xuICAgICAgICBlbGVtZW50ID0gdGhpcy5zY2FuVGVtcGxhdGVFbGVtZW50KCk7XG4gICAgICAgIGl0ZW1zLnB1c2goZWxlbWVudCk7XG4gICAgICAgIGlmIChlbGVtZW50LmludGVycCkge1xuICAgICAgICAgIGVsZW1lbnQgPSB0aGlzLnJlYWQoW10sIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICBhc3NlcnQoZWxlbWVudC5zaXplID09PSAxLCBcInNob3VsZCBvbmx5IGhhdmUgcmVhZCBhIHNpbmdsZSBkZWxpbWl0ZXIgaW5zaWRlIGEgdGVtcGxhdGVcIik7XG4gICAgICAgICAgaXRlbXMucHVzaChlbGVtZW50LmdldCgwKSk7XG4gICAgICAgIH1cbiAgICAgIH0gd2hpbGUgKCFlbGVtZW50LnRhaWwpO1xuICAgICAgcmV0dXJuIHt0eXBlOiBUb2tlblR5cGUuVEVNUExBVEUsIGl0ZW1zOiBMaXN0KGl0ZW1zKSwgc2xpY2U6IHRoaXMuZ2V0U2xpY2Uoc3RhcnQsIHN0YXJ0TG9jYXRpb25fNzgyKX07XG4gICAgfSBlbHNlIGlmIChjaGFyQ29kZV83ODMgPT09IDM1KSB7XG4gICAgICBsZXQgc3RhcnRMb2NhdGlvbl83ODIgPSB0aGlzLmdldExvY2F0aW9uKCk7XG4gICAgICBsZXQgc3RhcnQgPSB0aGlzLmluZGV4O1xuICAgICAgbGV0IHNsaWNlID0gdGhpcy5nZXRTbGljZShzdGFydCwgc3RhcnRMb2NhdGlvbl83ODIpO1xuICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgaWYgKHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy5pbmRleCkgPT09IDk2KSB7XG4gICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBMU1lOVEFYXzY1OCwgdmFsdWU6IFwiI2BcIiwgc2xpY2U6IHNsaWNlfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7dHlwZTogVG9rZW5UeXBlLklERU5USUZJRVIsIHZhbHVlOiBcIiNcIiwgc2xpY2U6IHNsaWNlfTtcbiAgICB9IGVsc2UgaWYgKGNoYXJDb2RlXzc4MyA9PT0gNjQpIHtcbiAgICAgIGxldCBzdGFydExvY2F0aW9uXzc4MiA9IHRoaXMuZ2V0TG9jYXRpb24oKTtcbiAgICAgIGxldCBzdGFydCA9IHRoaXMuaW5kZXg7XG4gICAgICBsZXQgc2xpY2UgPSB0aGlzLmdldFNsaWNlKHN0YXJ0LCBzdGFydExvY2F0aW9uXzc4Mik7XG4gICAgICB0aGlzLmluZGV4Kys7XG4gICAgICByZXR1cm4ge3R5cGU6IEFUXzY2MCwgdmFsdWU6IFwiQFwiLCBzbGljZTogc2xpY2V9O1xuICAgIH1cbiAgICBsZXQgbG9va2FoZWFkXzc4NCA9IHN1cGVyLmFkdmFuY2UoKTtcbiAgICBpZiAobG9va2FoZWFkXzc4NC50eXBlID09PSBUb2tlblR5cGUuRElWICYmIGlzUmVnZXhQcmVmaXhfNzEzKGJfNzgxKShwcmVmaXhfNzgwKSkge1xuICAgICAgcmV0dXJuIHN1cGVyLnNjYW5SZWdFeHAoXCIvXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbG9va2FoZWFkXzc4NDtcbiAgfVxuICBzY2FuVGVtcGxhdGVFbGVtZW50KCkge1xuICAgIGxldCBzdGFydExvY2F0aW9uXzc4NSA9IHRoaXMuZ2V0TG9jYXRpb24oKTtcbiAgICBsZXQgc3RhcnRfNzg2ID0gdGhpcy5pbmRleDtcbiAgICB3aGlsZSAodGhpcy5pbmRleCA8IHRoaXMuc291cmNlLmxlbmd0aCkge1xuICAgICAgbGV0IGNoID0gdGhpcy5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLmluZGV4KTtcbiAgICAgIHN3aXRjaCAoY2gpIHtcbiAgICAgICAgY2FzZSA5NjpcbiAgICAgICAgICBsZXQgc2xpY2UgPSB0aGlzLmdldFNsaWNlKHN0YXJ0Xzc4Niwgc3RhcnRMb2NhdGlvbl83ODUpO1xuICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICByZXR1cm4ge3R5cGU6IFRva2VuVHlwZS5URU1QTEFURSwgdGFpbDogdHJ1ZSwgaW50ZXJwOiBmYWxzZSwgc2xpY2U6IHNsaWNlfTtcbiAgICAgICAgY2FzZSAzNjpcbiAgICAgICAgICBpZiAodGhpcy5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLmluZGV4ICsgMSkgPT09IDEyMykge1xuICAgICAgICAgICAgbGV0IHNsaWNlID0gdGhpcy5nZXRTbGljZShzdGFydF83ODYsIHN0YXJ0TG9jYXRpb25fNzg1KTtcbiAgICAgICAgICAgIHRoaXMuaW5kZXggKz0gMTtcbiAgICAgICAgICAgIHJldHVybiB7dHlwZTogVG9rZW5UeXBlLlRFTVBMQVRFLCB0YWlsOiBmYWxzZSwgaW50ZXJwOiB0cnVlLCBzbGljZTogc2xpY2V9O1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgOTI6XG4gICAgICAgICAge1xuICAgICAgICAgICAgbGV0IG9jdGFsID0gdGhpcy5zY2FuU3RyaW5nRXNjYXBlKFwiXCIsIG51bGwpWzFdO1xuICAgICAgICAgICAgaWYgKG9jdGFsICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhpcy5jcmVhdGVJTExFR0FMKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyB0aGlzLmNyZWF0ZUlMTEVHQUwoKTtcbiAgfVxufVxuIl19